<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ç»Ÿä¸€ç™½åå•ç»„ä»¶ | bugstack è™«æ´æ ˆ</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/favicon.ico">
    <script charset="utf-8" async="async" src="/js/jquery.min.js"></script>
    <script charset="utf-8" async="async" src="/js/global.js"></script>
    <script charset="utf-8" async="async" src="/js/fingerprint2.min.js"></script>
    <script>
              var _hmt = _hmt || [];
              (function() {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?0b31b4c146bf7126aed5009e1a4a11c8";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
              })();
            </script>
    <meta name="description" content="åŒ…å«: Java åŸºç¡€ï¼Œé¢ç»æ‰‹å†Œï¼ŒNetty4.xï¼Œæ‰‹å†™Springï¼Œç”¨Javaå®ç°JVMï¼Œé‡å­¦Javaè®¾è®¡æ¨¡å¼ï¼ŒSpringBootä¸­é—´ä»¶å¼€å‘ï¼ŒIDEAæ’ä»¶å¼€å‘ï¼ŒDDDç³»ç»Ÿæ¶æ„é¡¹ç›®å¼€å‘ï¼Œå­—èŠ‚ç ç¼–ç¨‹...">
    <meta property="og:title" content="ç»Ÿä¸€ç™½åå•ç»„ä»¶">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/md/assembly/middleware/%E7%BB%9F%E4%B8%80%E7%99%BD%E5%90%8D%E5%8D%95%E7%BB%84%E4%BB%B6.html">
    <meta name="twitter:title" content="ç»Ÿä¸€ç™½åå•ç»„ä»¶">
    <meta name="twitter:url" content="/md/assembly/middleware/%E7%BB%9F%E4%B8%80%E7%99%BD%E5%90%8D%E5%8D%95%E7%BB%84%E4%BB%B6.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="robots" content="all">
    <meta name="author" content="å°å‚…å“¥">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="keywords" content="bugstack è™«æ´æ ˆ, DDDæŠ½å¥–ç³»ç»Ÿï¼Œæ•°æ®ç»“æ„ï¼Œé‡å­¦Javaè®¾è®¡æ¨¡å¼, å­—èŠ‚ç ç¼–ç¨‹, ä¸­é—´ä»¶, æ‰‹å†™Spring, æ‰‹å†™MyBatisï¼ŒJavaåŸºç¡€, é¢ç»æ‰‹å†Œï¼Œé¢è¯•é¢˜ï¼ŒAPIç½‘å…³ï¼ŒSpringBoot Stater">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="preload" href="/assets/css/0.styles.34a27db0.css" as="style"><link rel="preload" href="/assets/css/styles.css?v=1686664442105" as="style"><link rel="preload" href="/assets/js/cg-styles.js?v=1686664442105" as="script"><link rel="preload" href="/assets/js/cg-app.js?v=1686664442105" as="script"><link rel="preload" href="/assets/js/cg-3.js?v=1686664442105" as="script"><link rel="preload" href="/assets/js/cg-4.js?v=1686664442105" as="script"><link rel="preload" href="/assets/js/cg-10.js?v=1686664442105" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.34a27db0.css"><link rel="stylesheet" href="/assets/css/styles.css?v=1686664442105">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">bugstack è™«æ´æ ˆ</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/java/interview/2020-07-28-é¢ç»æ‰‹å†Œ Â· å¼€ç¯‡ã€Šé¢è¯•å®˜éƒ½é—®æˆ‘å•¥ã€‹.html" class="nav-link">
  é¢ç»æ‰‹å†Œ
</a></li><li class="dropdown-item"><!----> <a href="/md/java/develop-jvm/2019-05-01-ç”¨Javaå®ç°JVMç¬¬ä¸€ç« ã€Šå‘½ä»¤è¡Œå·¥å…·ã€‹.html" class="nav-link">
  ç”¨Javaå®ç°JVM
</a></li><li class="dropdown-item"><!----> <a href="/md/java/core/2020-01-06-[æºç åˆ†æ]å’‹å˜ï¼Ÿä½ çš„IDEAè¿‡æœŸäº†å§ï¼åŠ ä¸ªJaråŒ…å°±ç ´è§£äº†ï¼Œä¸ºä»€ä¹ˆï¼Ÿ.html" class="nav-link">
  åŸºç¡€æŠ€æœ¯
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ä¸­é—´ä»¶" class="dropdown-title"><span class="title">ä¸­é—´ä»¶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/assembly/middleware/ç»Ÿä¸€ç™½åå•ç»„ä»¶.html" class="nav-link">
  springbootä¸­é—´ä»¶
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/java/interview/2020-07-28-é¢ç»æ‰‹å†Œ Â· å¼€ç¯‡ã€Šé¢è¯•å®˜éƒ½é—®æˆ‘å•¥ã€‹.html" class="nav-link">
  é¢ç»æ‰‹å†Œ
</a></li><li class="dropdown-item"><!----> <a href="/md/java/develop-jvm/2019-05-01-ç”¨Javaå®ç°JVMç¬¬ä¸€ç« ã€Šå‘½ä»¤è¡Œå·¥å…·ã€‹.html" class="nav-link">
  ç”¨Javaå®ç°JVM
</a></li><li class="dropdown-item"><!----> <a href="/md/java/core/2020-01-06-[æºç åˆ†æ]å’‹å˜ï¼Ÿä½ çš„IDEAè¿‡æœŸäº†å§ï¼åŠ ä¸ªJaråŒ…å°±ç ´è§£äº†ï¼Œä¸ºä»€ä¹ˆï¼Ÿ.html" class="nav-link">
  åŸºç¡€æŠ€æœ¯
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ä¸­é—´ä»¶" class="dropdown-title"><span class="title">ä¸­é—´ä»¶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/assembly/middleware/ç»Ÿä¸€ç™½åå•ç»„ä»¶.html" class="nav-link">
  springbootä¸­é—´ä»¶
</a></li></ul></div></div> <!----></nav>  <!----> </aside> <div><main class="withouttoc page"> <div class="theme-default-content content__default"><h2 id="ç»Ÿä¸€ç™½åå•ç»„ä»¶"><a href="#ç»Ÿä¸€ç™½åå•ç»„ä»¶" class="header-anchor">#</a> ç»Ÿä¸€ç™½åå•ç»„ä»¶</h2> <blockquote><p>è¯¥é¡¹ç›®çš„å­¦ä¹ æ¥æºäºå°å‚…å“¥çš„<a href="https://wx.zsxq.com/dweb2/index/group/48411118851818" target="_blank" rel="noopener noreferrer">çŸ¥è¯†æ˜Ÿçƒ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>ğŸ¤ºğŸ¤ºğŸ¤º è®¤çœŸå­¦ä¹ ã€å½’çº³æ•´ç†</p></blockquote> <h3 id="_1ã€ç›®çš„"><a href="#_1ã€ç›®çš„" class="header-anchor">#</a> 1ã€ç›®çš„</h3> <p>æƒ³è¦å¯¹æŸä¸€äº›æ¥å£å®ç°ç™½åå•åŠŸèƒ½ï¼Œé€šè¿‡ç™½åå•çš„è¿›è¡Œæ”¾è¡Œã€‚</p> <p>ä¾‹å¦‚ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>     <span class="token operator">*</span> é€šè¿‡ï¼šhttp<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">8081</span><span class="token operator">/</span>api<span class="token operator">/</span>queryUserInfo<span class="token operator">?</span>userId<span class="token operator">=</span>zzz
     <span class="token operator">*</span> æ‹¦æˆªï¼šhttp<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">8081</span><span class="token operator">/</span>api<span class="token operator">/</span>queryUserInfo<span class="token operator">?</span>userId<span class="token operator">=</span>aaa
     
    <span class="token annotation punctuation">@DoWhiteList</span><span class="token punctuation">(</span>key <span class="token operator">=</span> <span class="token string">&quot;userId&quot;</span><span class="token punctuation">,</span> returnJson <span class="token operator">=</span> <span class="token string">&quot;{\&quot;code\&quot;:\&quot;1111\&quot;,\&quot;info\&quot;:\&quot;éç™½åå•å¯è®¿é—®ç”¨æˆ·æ‹¦æˆªï¼\&quot;}&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">&quot;/api/queryUserInfo&quot;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">UserInfo</span> <span class="token function">queryUserInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼ŒuserIdï¼š{}&quot;</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>ä¸ºäº†æ›´æ–¹ä¾¿å¿«æ·çš„å®ç°æ­¤åŠŸèƒ½ï¼Œäºæ˜¯é‡‡ç”¨æ³¨è§£å½¢ + åˆ‡é¢æ¥å¼€å‘ç™½åå•ä¸­é—´ä»¶ã€‚</p> <h2 id="_2ã€å·¥ç¨‹ç»“æ„"><a href="#_2ã€å·¥ç¨‹ç»“æ„" class="header-anchor">#</a> 2ã€å·¥ç¨‹ç»“æ„</h2> <div class="language-java line-numbers-mode"><pre class="language-java"><code>â”€whitelist<span class="token operator">-</span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter
â”‚  â”œâ”€src
â”‚  â”‚  â”œâ”€main
â”‚  â”‚  â”‚  â”œâ”€java
â”‚  â”‚  â”‚  â”‚  â””â”€com
â”‚  â”‚  â”‚  â”‚      â””â”€zzz
â”‚  â”‚  â”‚  â”‚          â””â”€whitelist
â”‚  â”‚  â”‚  â”‚              â”‚  <span class="token class-name">DoJoinPoint</span><span class="token punctuation">.</span>java
â”‚  â”‚  â”‚  â”‚              â”‚
â”‚  â”‚  â”‚  â”‚              â”œâ”€annotation
â”‚  â”‚  â”‚  â”‚              â”‚      <span class="token class-name">DoWhiteList</span><span class="token punctuation">.</span>java
â”‚  â”‚  â”‚  â”‚              â”‚
â”‚  â”‚  â”‚  â”‚              â””â”€config
â”‚  â”‚  â”‚  â”‚                      <span class="token class-name">WhiteListAutoConfigure</span><span class="token punctuation">.</span>java
â”‚  â”‚  â”‚  â”‚                      <span class="token class-name">WhiteListProperties</span><span class="token punctuation">.</span>java
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ul><li>DoJoinPoint.java : è´Ÿè´£å¯¹è‡ªå®šä¹‰æ³¨è§£çš„æ–¹æ³•è¿›è¡Œæ‹¦æˆªå’Œé€»è¾‘å¤„ç†ã€‚</li> <li>DoWhiteList.java ï¼š è‡ªå®šä¹‰æ³¨è§£ç±»ã€‚</li> <li>WhiteListAutoConfigure.java ï¼šå°†priperties.ymlä¸­å¯¹ç™½åå•çš„é…ç½®è¯»å–åˆ°ä¸­é—´ä»¶ä¸­ã€‚</li> <li>WhiteListProperties.java ï¼šymlé…ç½®å¯¹åº”çš„å®ä½“ç±»</li></ul> <h2 id="_3ã€ä»£ç "><a href="#_3ã€ä»£ç " class="header-anchor">#</a> 3ã€ä»£ç </h2> <h3 id="_1ã€dowhitelist"><a href="#_1ã€dowhitelist" class="header-anchor">#</a> 1ã€DoWhiteList</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">DoWhiteList</span> <span class="token punctuation">{</span>

    <span class="token class-name">String</span> <span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> <span class="token function">returnJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>@Retention : ç”¨äºæŒ‡å®šæ³¨è§£çš„ä¿ç•™ç­–ç•¥ã€‚å®ƒæœ‰ä¸€ä¸ªå‚æ•°<code>RetentionPolicy</code>ï¼Œè¡¨ç¤ºæ³¨è§£çš„ä¿ç•™ç­–ç•¥ï¼ŒåŒ…æ‹¬ä¸‰ç§ç­–ç•¥ï¼š
<ul><li><code>RetentionPolicy.SOURCE</code>ï¼šæ³¨è§£åªä¿ç•™åœ¨æºä»£ç ä¸­ï¼Œç¼–è¯‘å™¨ä¼šå¿½ç•¥è¯¥æ³¨è§£ã€‚</li> <li><code>RetentionPolicy.CLASS</code>ï¼šæ³¨è§£ä¿ç•™åœ¨ç¼–è¯‘åçš„å­—èŠ‚ç æ–‡ä»¶ä¸­ï¼Œä½†åœ¨è¿è¡Œæ—¶ä¸ä¼šè¢«JVMä¿ç•™ã€‚</li> <li><code>RetentionPolicy.RUNTIME</code>ï¼šæ³¨è§£ä¿ç•™åœ¨ç¼–è¯‘åçš„å­—èŠ‚ç æ–‡ä»¶ä¸­ï¼Œå¹¶åœ¨è¿è¡Œæ—¶ä¿ç•™ï¼Œå¯ä»¥é€šè¿‡åå°„æœºåˆ¶è¯»å–æ³¨è§£ä¿¡æ¯ã€‚</li></ul></li> <li>@Target : ç”¨äºæŒ‡å®šæ³¨è§£å¯ä»¥åº”ç”¨äºå“ªäº›å…ƒç´ ä¸Šã€‚å®ƒå¯ä»¥ç”¨æ¥ä¿®é¥°è‡ªå®šä¹‰æ³¨è§£ï¼Œä»¥é™åˆ¶æ³¨è§£çš„ä½¿ç”¨èŒƒå›´ã€‚<code>@Target</code>æœ‰å¤šä¸ªå–å€¼ï¼Œä¸åŒçš„å–å€¼ä»£è¡¨äº†æ³¨è§£å¯ä»¥åº”ç”¨äºä¸åŒçš„å…ƒç´ ä¸Šï¼ŒåŒ…æ‹¬:
<ul><li><code>ElementType.TYPE</code></li> <li><code>ElementType.FIELD</code></li> <li><code>ElementType.METHOD</code></li> <li><code>ElementType.PARAMETER</code></li> <li><code>ElementType.CONSTRUCTOR</code></li> <li><code>ElementType.LOCAL_VARIABLE</code></li> <li><code>ElementType.ANNOTATION_TYPE</code></li> <li><code>ElementType.PACKAGE</code></li></ul></li></ul> <p>è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªæ³¨è§£<code>DoWhiteList</code>ï¼Œå®ƒçš„ä¿ç•™ç­–ç•¥æ˜¯<code>RetentionPolicy.RUNTIME</code>ï¼Œè¡¨ç¤ºåœ¨è¿è¡Œæ—¶ä¹Ÿå¯ä»¥é€šè¿‡åå°„è·å–åˆ°è¯¥æ³¨è§£ã€‚åŒæ—¶ï¼Œè¯¥æ³¨è§£åªèƒ½åº”ç”¨äºæ–¹æ³•ä¸Šï¼Œå› ä¸ºå®ƒçš„<code>@Target</code>å–å€¼ä¸º<code>ElementType.METHOD</code>ã€‚è¯¥æ³¨è§£æœ‰ä¸¤ä¸ªå±æ€§ï¼Œä¸€ä¸ªæ˜¯<code>key</code>ï¼Œä¸€ä¸ªæ˜¯<code>returnJson</code>ï¼Œé»˜è®¤å€¼éƒ½æ˜¯ç©ºå­—ç¬¦ä¸²ã€‚å®šä¹‰æ³¨è§£æ—¶ï¼Œå¯ä»¥é€šè¿‡<code>@DoWhiteList(key = &quot;xxx&quot;, returnJson = &quot;{\&quot;code\&quot;: 200}&quot;)</code>çš„æ–¹å¼æ¥ç»™æ³¨è§£å±æ€§èµ‹å€¼ã€‚è¿™ä¸ªæ³¨è§£çš„ä½œç”¨å¯ä»¥æ ¹æ®å…·ä½“çš„ä¸šåŠ¡åœºæ™¯æ¥å®šä¹‰ï¼Œä¾‹å¦‚åœ¨æ¥å£æ–¹æ³•ä¸Šæ·»åŠ è¯¥æ³¨è§£ï¼Œè¡¨ç¤ºè¯¥æ–¹æ³•éœ€è¦è¿›è¡Œç™½åå•æ ¡éªŒï¼Œ<code>key</code>å±æ€§è¡¨ç¤ºç™½åå•çš„keyï¼Œ<code>returnJson</code>å±æ€§è¡¨ç¤ºæ ¡éªŒæœªé€šè¿‡æ—¶è¿”å›çš„JSONæ•°æ®ã€‚</p> <h3 id="_2ã€dojoinpoint"><a href="#_2ã€dojoinpoint" class="header-anchor">#</a> 2ã€DoJoinPoint</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Aspect</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DoJoinPoint</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">DoJoinPoint</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> whiteListConfig<span class="token punctuation">;</span>

    <span class="token comment">/**
     * å®šä¹‰åˆ‡ç‚¹
     */</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;@annotation(com.zzz.whitelist.annotation.DoWhiteList)&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">aopPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @param jp æ˜¯ Spring AOP ä¸­çš„ä¸€ä¸ªæ¥å£ï¼Œå®ƒç”¨äºæ§åˆ¶è¢«åˆ‡å…¥æ–¹æ³•çš„æ‰§è¡Œã€‚
     *           åœ¨ @Around æ³¨è§£ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ ProceedingJoinPoint å‚æ•°æ¥æ§åˆ¶è¢«åˆ‡å…¥æ–¹æ³•çš„æ‰§è¡Œï¼Œ
     *           ä¾‹å¦‚åœ¨æ–¹æ³•æ‰§è¡Œå‰è¿›è¡Œä¸€äº›æ“ä½œï¼Œæˆ–è€…åœ¨æ–¹æ³•æ‰§è¡Œåè¿›è¡Œä¸€äº›æ“ä½œï¼Œè¿˜å¯ä»¥ä¿®æ”¹æ–¹æ³•çš„è¿”å›å€¼æˆ–æŠ›å‡ºå¼‚å¸¸ç­‰ã€‚
     */</span>
    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">&quot;aopPoint()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">doRouter</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> jp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token comment">// è·å–å†…å®¹</span>
        <span class="token class-name">Method</span> method <span class="token operator">=</span> <span class="token function">getMethod</span><span class="token punctuation">(</span>jp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DoWhiteList</span> whiteList <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span><span class="token class-name">DoWhiteList</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// è·å–å­—æ®µå€¼</span>
        <span class="token class-name">String</span> keyValue <span class="token operator">=</span> <span class="token function">getFiledValue</span><span class="token punctuation">(</span>whiteList<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> jp<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;middleware whitelist handler methodï¼š{} valueï¼š{}&quot;</span><span class="token punctuation">,</span> method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> keyValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> keyValue <span class="token operator">||</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>keyValue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> jp<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> split <span class="token operator">=</span> whiteListConfig<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ç™½åå•è¿‡æ»¤</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> str <span class="token operator">:</span> split<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>keyValue<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> jp<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// æ‹¦æˆª</span>
        <span class="token keyword">return</span> <span class="token function">returnObject</span><span class="token punctuation">(</span>whiteList<span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">Method</span> <span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> jp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchMethodException</span> <span class="token punctuation">{</span>
        <span class="token comment">//è¯¥å¯¹è±¡è¡¨ç¤ºå½“å‰è¿æ¥ç‚¹çš„ç­¾åã€‚åœ¨ Spring AOP ä¸­ï¼Œè¿æ¥ç‚¹æ˜¯åœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­å¯ä»¥æ’å…¥åˆ‡é¢çš„ç‚¹ï¼Œ</span>
        <span class="token comment">// ä¾‹å¦‚æ–¹æ³•è°ƒç”¨æˆ–å¼‚å¸¸æŠ›å‡ºã€‚Signature æ¥å£æä¾›äº†è·å–è¿æ¥ç‚¹ç­¾åä¿¡æ¯çš„æ–¹æ³•ï¼Œ</span>
        <span class="token comment">// åŒ…æ‹¬æ–¹æ³•åã€å‚æ•°ã€è¿”å›ç±»å‹ç­‰ã€‚åœ¨åˆ‡é¢ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ JoinPoint.getSignature()</span>
        <span class="token comment">// è·å–å½“å‰è¿æ¥ç‚¹çš„ç­¾åä¿¡æ¯ï¼Œå¹¶æ ¹æ®éœ€è¦è¿›è¡Œå¤„ç†ã€‚</span>
        <span class="token class-name">Signature</span> sig <span class="token operator">=</span> jp<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MethodSignature</span> methodSignature <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">MethodSignature</span><span class="token punctuation">)</span> sig<span class="token punctuation">;</span>
        <span class="token keyword">return</span> jp<span class="token punctuation">.</span><span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>methodSignature<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> methodSignature<span class="token punctuation">.</span><span class="token function">getParameterTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// è¿”å›å¯¹è±¡</span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> <span class="token function">returnObject</span><span class="token punctuation">(</span><span class="token class-name">DoWhiteList</span> whiteList<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IllegalAccessException</span><span class="token punctuation">,</span> <span class="token class-name">InstantiationException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> returnType <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getReturnType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> returnJson <span class="token operator">=</span> whiteList<span class="token punctuation">.</span><span class="token function">returnJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>returnJson<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> returnType<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>returnJson<span class="token punctuation">,</span> returnType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// è·å–å±æ€§å€¼</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getFiledValue</span><span class="token punctuation">(</span><span class="token class-name">String</span> filed<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> filedValue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Object</span> arg <span class="token operator">:</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> filedValue <span class="token operator">||</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>filedValue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    filedValue <span class="token operator">=</span> <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span>arg<span class="token punctuation">,</span> filed<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> filedValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br></div></div><ul><li>@Aspect ï¼šç”¨äºå®šä¹‰åˆ‡é¢ã€‚</li> <li>@Component ï¼šç”¨äºå£°æ˜ä¸€ä¸ªbeançš„æ³¨è§£ï¼Œå®ƒå¯ä»¥è¢«ç”¨åœ¨ä»»ä½•ç±»ä¸Šï¼Œè¡¨ç¤ºè¿™ä¸ªç±»å°†ä¼šè¢«Springå®¹å™¨æ‰€ç®¡ç†ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡å®¹å™¨è·å–åˆ°è¯¥ç±»çš„å®ä¾‹ã€‚åœ¨ä½¿ç”¨<code>@Component</code>æ³¨è§£æ—¶ï¼Œè¿˜å¯ä»¥é€šè¿‡æŒ‡å®šbeançš„åç§°æ¥è¿›è¡Œå‘½åï¼Œä¾‹å¦‚<code>@Component(&quot;myBean&quot;)</code>ã€‚</li> <li>@Pointcut ï¼š ç”¨äºå®šä¹‰åˆ‡ç‚¹çš„æ³¨è§£ã€‚åˆ‡ç‚¹æ˜¯æŒ‡åœ¨åº”ç”¨ç¨‹åºä¸­çš„æŸä¸ªç‰¹å®šä½ç½®ï¼Œæˆ‘ä»¬å¸Œæœ›æ‹¦æˆªåˆ°æŸäº›æ–¹æ³•çš„æ‰§è¡Œï¼Œå¹¶åœ¨è¿™äº›æ–¹æ³•æ‰§è¡Œå‰ã€æ‰§è¡Œåæˆ–è€…åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­åšä¸€äº›é¢å¤–çš„å¤„ç†ã€‚</li> <li>@Around ï¼šç”¨äºå®šä¹‰ç¯ç»•é€šçŸ¥çš„æ³¨è§£ã€‚ç¯ç»•é€šçŸ¥æ˜¯æŒ‡åœ¨æ–¹æ³•æ‰§è¡Œå‰å’Œæ–¹æ³•æ‰§è¡Œåéƒ½å¯ä»¥æ‰§è¡Œçš„é€šçŸ¥ï¼Œå®ƒå¯ä»¥æ§åˆ¶æ–¹æ³•çš„æ‰§è¡Œæµç¨‹ï¼Œç”šè‡³å¯ä»¥å®Œå…¨æ›¿ä»£åŸæœ‰æ–¹æ³•çš„æ‰§è¡Œã€‚åœ¨ä½¿ç”¨<code>@Around</code>æ³¨è§£æ—¶ï¼Œéœ€è¦å°†åˆ‡ç‚¹è¡¨è¾¾å¼ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œå¹¶ä¸”éœ€è¦åœ¨æ–¹æ³•ä¸­æ˜¾å¼è°ƒç”¨<code>ProceedingJoinPoint.proceed()</code>æ–¹æ³•æ¥æ‰§è¡ŒåŸæœ‰æ–¹æ³•ã€‚</li></ul> <p>è¿™æ®µä»£ç æ˜¯ä¸€ä¸ªä½¿ç”¨Spring AOPå®ç°çš„æ‹¦æˆªå™¨ï¼Œç”¨äºæ‹¦æˆªå¸¦æœ‰<code>@DoWhiteList</code>æ³¨è§£çš„æ–¹æ³•ï¼Œå¹¶å¯¹æ–¹æ³•å‚æ•°è¿›è¡Œç™½åå•è¿‡æ»¤ã€‚å…¶ä¸­ï¼Œ<code>@Aspect</code>å’Œ<code>@Component</code>æ³¨è§£ç”¨äºå£°æ˜è¿™æ˜¯ä¸€ä¸ªåˆ‡é¢ï¼Œå¹¶å°†å…¶æ³¨å†Œä¸ºSpringçš„ä¸€ä¸ªbeanã€‚<code>@Around</code>æ³¨è§£çš„å‚æ•°æ˜¯<code>aopPoint()</code>ï¼Œè¡¨ç¤ºæ‹¦æˆª<code>aopPoint()</code>æ–¹æ³•æ‰€å¯¹åº”çš„æ‰€æœ‰å¸¦æœ‰<code>@DoWhiteList</code>æ³¨è§£çš„æ–¹æ³•ã€‚åœ¨<code>doRouter()</code>æ–¹æ³•ä¸­ï¼Œé€šè¿‡<code>ProceedingJoinPoint</code>å‚æ•°æ§åˆ¶è¢«åˆ‡å…¥æ–¹æ³•çš„æ‰§è¡Œï¼Œå¹¶å¯¹æ–¹æ³•å‚æ•°è¿›è¡Œç™½åå•è¿‡æ»¤ã€‚å¦‚æœå‚æ•°åœ¨ç™½åå•ä¸­ï¼Œåˆ™ç»§ç»­æ‰§è¡Œè¢«æ‹¦æˆªçš„æ–¹æ³•ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªè‡ªå®šä¹‰çš„å¯¹è±¡æˆ–è€…æŠ›å‡ºå¼‚å¸¸ã€‚</p> <h3 id="_3ã€whitelistproperties"><a href="#_3ã€whitelistproperties" class="header-anchor">#</a> 3ã€WhiteListProperties</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;zzz.whitelist&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WhiteListProperties</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> users<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> users<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUsers</span><span class="token punctuation">(</span><span class="token class-name">String</span> users<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>users <span class="token operator">=</span> users<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li>@ConfigurationProperties ï¼šç”¨äºå°†é…ç½®æ–‡ä»¶ä¸­çš„å±æ€§å€¼è‡ªåŠ¨ç»‘å®šåˆ°Javaç±»çš„å±æ€§ä¸Šã€‚é€šè¿‡è¿™ä¸ªæ³¨è§£ï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°å°†é…ç½®æ–‡ä»¶ä¸­çš„å±æ€§å€¼æ³¨å…¥åˆ°æˆ‘ä»¬çš„Javaç±»ä¸­ï¼Œé¿å…äº†æ‰‹åŠ¨ä»é…ç½®æ–‡ä»¶ä¸­è¯»å–å±æ€§å€¼çš„ç¹çæ“ä½œã€‚<strong>æˆ‘ä»¬éœ€è¦ä¸ºè¿™ä¸ªæ³¨è§£æŒ‡å®šä¸€ä¸ªå‰ç¼€ï¼Œè¿™ä¸ªå‰ç¼€ä¼šä¸é…ç½®æ–‡ä»¶ä¸­çš„å±æ€§åè¿›è¡ŒåŒ¹é…ï¼ŒåŒ¹é…æˆåŠŸåå°±ä¼šå°†å¯¹åº”çš„å±æ€§å€¼æ³¨å…¥åˆ°Javaç±»çš„å±æ€§ä¸­ã€‚</strong></li></ul> <p>è¿™æ®µä»£ç æ˜¯ä¸€ä¸ªJavaç±»ï¼Œä½¿ç”¨äº†<code>@ConfigurationProperties</code>æ³¨è§£ï¼Œè¡¨ç¤ºå°†é…ç½®æ–‡ä»¶ä¸­<code>zzz.whitelist</code>å‰ç¼€çš„å±æ€§å€¼ç»‘å®šåˆ°è¯¥ç±»çš„å±æ€§ä¸Šã€‚è¯¥ç±»æœ‰ä¸€ä¸ª<code>users</code>å±æ€§ï¼Œè¡¨ç¤ºç™½åå•ä¸­çš„ç”¨æˆ·åˆ—è¡¨ã€‚<code>getUsers()</code>å’Œ<code>setUsers()</code>æ–¹æ³•åˆ†åˆ«ç”¨äºè·å–å’Œè®¾ç½®è¯¥å±æ€§çš„å€¼ã€‚å½“æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®äº†<code>zzz.whitelist.users</code>å±æ€§æ—¶ï¼ŒSpringæ¡†æ¶ä¼šè‡ªåŠ¨å°†è¯¥å±æ€§å€¼æ³¨å…¥åˆ°<code>WhiteListProperties</code>ç±»çš„<code>users</code>å±æ€§ä¸­ã€‚</p> <h3 id="_4ã€whitelistautoconfigure"><a href="#_4ã€whitelistautoconfigure" class="header-anchor">#</a> 4ã€WhiteListAutoConfigure</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token class-name">WhiteListProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token class-name">WhiteListProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WhiteListAutoConfigure</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;whiteListConfig&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ConditionalOnMissingBean</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">whiteListConfig</span><span class="token punctuation">(</span><span class="token class-name">WhiteListProperties</span> properties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> properties<span class="token punctuation">.</span><span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>@Configuration : ç”¨äºå®šä¹‰åº”ç”¨ç¨‹åºä¸­çš„beanï¼Œå¯ä»¥æ›¿ä»£XMLé…ç½®æ–‡ä»¶ã€‚</li> <li>@ConditionalOnClass ï¼š è¡¨ç¤ºå½“æŒ‡å®šçš„ç±»å­˜åœ¨äºç±»è·¯å¾„ä¸­æ—¶ï¼Œæ‰ä¼šåˆ›å»ºè¢«æ³¨è§£çš„Beanã€‚è¯¥æ³¨è§£å¯ä»¥ç”¨äºåœ¨ä¸åŒçš„ç¯å¢ƒä¸‹åˆ›å»ºä¸åŒçš„Beanï¼Œæ¯”å¦‚åœ¨Webç¯å¢ƒä¸‹åˆ›å»ºä¸€ä¸ªBeanï¼Œåœ¨éWebç¯å¢ƒä¸‹ä¸åˆ›å»ºè¯¥Beanã€‚<code>@ConditionalOnClass</code>æ³¨è§£è¿˜å¯ä»¥ä¸<code>@ConditionalOnMissingClass</code>æ³¨è§£é…åˆä½¿ç”¨ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªBeanï¼Œå½“æŒ‡å®šçš„ç±»ä¸å­˜åœ¨æ—¶ã€‚</li> <li>@EnableConfigurationProperties ï¼š ç”¨äºå¯ç”¨ä¸€ä¸ªæˆ–å¤šä¸ª<code>@ConfigurationProperties</code>æ³¨è§£çš„ç±»ã€‚å½“æˆ‘ä»¬åœ¨Spring Bootåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨<code>@ConfigurationProperties</code>æ³¨è§£æ—¶ï¼Œéœ€è¦ä½¿ç”¨<code>@EnableConfigurationProperties</code>æ³¨è§£æ¥å¯ç”¨è¯¥æ³¨è§£æ‰€åœ¨çš„ç±»ã€‚è¯¥æ³¨è§£é€šå¸¸ç”¨äºå°†é…ç½®æ–‡ä»¶ä¸­çš„å±æ€§å€¼è‡ªåŠ¨ç»‘å®šåˆ°Javaç±»çš„å±æ€§ä¸Šã€‚åœ¨ä½¿ç”¨è¯¥æ³¨è§£æ—¶ï¼Œéœ€è¦å°†éœ€è¦ç»‘å®šå±æ€§çš„ç±»ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œä¾‹å¦‚<code>@EnableConfigurationProperties(MyProperties.class)</code>ã€‚è¿™æ ·ï¼ŒSpring Bootå°±ä¼šè‡ªåŠ¨å°†é…ç½®æ–‡ä»¶ä¸­çš„å±æ€§å€¼ç»‘å®šåˆ°<code>MyProperties</code>ç±»çš„å±æ€§ä¸Šã€‚</li> <li>@Beanï¼šç”¨äºåœ¨Springå®¹å™¨ä¸­å®šä¹‰ä¸€ä¸ªbeanã€‚</li> <li>@ConditionalOnMissingBean ï¼š ç”¨äºåœ¨æ»¡è¶³æŒ‡å®šæ¡ä»¶æ—¶æ‰æ³¨å†Œä¸€ä¸ªBeanã€‚å…·ä½“æ¥è¯´ï¼Œå½“Springå®¹å™¨ä¸­ä¸å­˜åœ¨æŒ‡å®šç±»å‹çš„Beanæ—¶ï¼Œæ‰ä¼šæ³¨å†Œè¢«æ³¨è§£çš„Beanã€‚</li></ul> <p>è¿™æ®µä»£ç æ˜¯ä¸€ä¸ªSpring Bootçš„è‡ªåŠ¨é…ç½®ç±»ï¼Œç”¨äºè‡ªåŠ¨é…ç½®ä¸€ä¸ªåä¸º<code>whiteListConfig</code>çš„Beanã€‚å…·ä½“æ¥è¯´ï¼Œè¿™ä¸ªè‡ªåŠ¨é…ç½®ç±»ä½¿ç”¨äº†<code>@Configuration</code>æ³¨è§£ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼›<code>@ConditionalOnClass(WhiteListProperties.class)</code>æ³¨è§£è¡¨ç¤ºåªæœ‰å½“<code>WhiteListProperties</code>ç±»å­˜åœ¨æ—¶ï¼Œæ‰ä¼šå¯ç”¨è¿™ä¸ªè‡ªåŠ¨é…ç½®ç±»ï¼›<code>@EnableConfigurationProperties(WhiteListProperties.class)</code>æ³¨è§£è¡¨ç¤ºå°†<code>WhiteListProperties</code>ç±»æ³¨å†Œä¸ºä¸€ä¸ªé…ç½®å±æ€§ç±»ï¼Œä½¿å¾—å¯ä»¥é€šè¿‡<code>@Autowired</code>æ³¨è§£å°†å…¶æ³¨å…¥åˆ°å…¶ä»–Beanä¸­ï¼›<code>@Bean(&quot;whiteListConfig&quot;)</code>æ³¨è§£è¡¨ç¤ºå°†<code>whiteListConfig</code>æ–¹æ³•è¿”å›çš„å¯¹è±¡æ³¨å†Œä¸ºä¸€ä¸ªBeanï¼Œåç§°ä¸º<code>whiteListConfig</code>ï¼›<code>@ConditionalOnMissingBean</code>æ³¨è§£è¡¨ç¤ºåªæœ‰å½“Springå®¹å™¨ä¸­ä¸å­˜åœ¨åä¸º<code>whiteListConfig</code>çš„Beanæ—¶ï¼Œæ‰ä¼šè°ƒç”¨<code>whiteListConfig</code>æ–¹æ³•åˆ›å»ºä¸€ä¸ªå¯¹è±¡å¹¶æ³¨å†Œä¸ºBeanã€‚</p> <p><code>whiteListConfig</code>æ–¹æ³•çš„å‚æ•°ä¸º<code>WhiteListProperties</code>ç±»å‹ï¼Œè¡¨ç¤ºå°†è‡ªåŠ¨æ³¨å…¥ä¸€ä¸ªåä¸º<code>whiteList</code>çš„é…ç½®å±æ€§å¯¹è±¡ã€‚<code>whiteListConfig</code>æ–¹æ³•çš„è¿”å›å€¼ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºå°†<code>whiteList</code>å±æ€§ä¸­çš„<code>users</code>å±æ€§å€¼ä½œä¸º<code>whiteListConfig</code> Beançš„å€¼è¿”å›ã€‚å¦‚æœ<code>whiteListConfig</code> Beanå·²ç»å­˜åœ¨äºSpringå®¹å™¨ä¸­ï¼Œåˆ™ä¸ä¼šå†æ¬¡åˆ›å»ºï¼Œç›´æ¥è¿”å›å·²å­˜åœ¨çš„Beanã€‚</p> <h2 id="_4ã€éªŒè¯"><a href="#_4ã€éªŒè¯" class="header-anchor">#</a> 4ã€éªŒè¯</h2> <p>1ã€åˆ›å»ºä¸€ä¸ªæµ‹è¯•å·¥ç¨‹ï¼Œé€šè¿‡pom.xmlå°†ç™½åå•ä¸­é—´ä»¶å¼•å…¥ã€‚</p> <p>2ã€åœ¨ymlä¸­é…ç½®ç™½åå•ç”¨æˆ·</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># ç™½åå•ç”¨æˆ·</span>
<span class="token key atrule">zzz</span><span class="token punctuation">:</span>
  <span class="token key atrule">whitelist</span><span class="token punctuation">:</span>
    <span class="token key atrule">users</span><span class="token punctuation">:</span> zzz
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>3ã€åˆ›å»ºæ¥å£ï¼Œè¿›è¡Œæµ‹è¯•</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@DoWhiteList</span><span class="token punctuation">(</span>key <span class="token operator">=</span> <span class="token string">&quot;userId&quot;</span><span class="token punctuation">,</span> returnJson <span class="token operator">=</span> <span class="token string">&quot;{\&quot;code\&quot;:\&quot;1111\&quot;,\&quot;info\&quot;:\&quot;éç™½åå•å¯è®¿é—®ç”¨æˆ·æ‹¦æˆªï¼\&quot;}&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">&quot;/api/queryUserInfo&quot;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">UserInfo</span> <span class="token function">queryUserInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼ŒuserIdï¼š{}&quot;</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div> <footer class="page-edit"><div class="edit-link"><a rel="noopener noreferrer"> aaaa </a></div> <!----></footer> <!----> </main></div> <aside class="page-sidebar"> <div class="page-side-toolbar"><!----> <div class="option-box-toc-over"><img src="/images/system/toc.png" class="nozoom"> <span class="show-txt">ç›®å½•</span> <div class="toc-container"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="max-height:550px"><div style="font-weight:bold;text-align:center;">ç»Ÿä¸€ç™½åå•ç»„ä»¶</div> <hr> <div class="toc-box"><ul class="toc-sidebar-links"><li><a href="/md/assembly/middleware/%E7%BB%9F%E4%B8%80%E7%99%BD%E5%90%8D%E5%8D%95%E7%BB%84%E4%BB%B6.html#ç»Ÿä¸€ç™½åå•ç»„ä»¶" class="toc-sidebar-link">ç»Ÿä¸€ç™½åå•ç»„ä»¶</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/md/assembly/middleware/%E7%BB%9F%E4%B8%80%E7%99%BD%E5%90%8D%E5%8D%95%E7%BB%84%E4%BB%B6.html#_1ã€ç›®çš„" class="toc-sidebar-link">1ã€ç›®çš„</a></li></ul></li><li><a href="/md/assembly/middleware/%E7%BB%9F%E4%B8%80%E7%99%BD%E5%90%8D%E5%8D%95%E7%BB%84%E4%BB%B6.html#_2ã€å·¥ç¨‹ç»“æ„" class="toc-sidebar-link">2ã€å·¥ç¨‹ç»“æ„</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/md/assembly/middleware/%E7%BB%9F%E4%B8%80%E7%99%BD%E5%90%8D%E5%8D%95%E7%BB%84%E4%BB%B6.html#_3ã€ä»£ç " class="toc-sidebar-link">3ã€ä»£ç </a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/md/assembly/middleware/%E7%BB%9F%E4%B8%80%E7%99%BD%E5%90%8D%E5%8D%95%E7%BB%84%E4%BB%B6.html#_1ã€dowhitelist" class="toc-sidebar-link">1ã€DoWhiteList</a></li><li class="toc-sidebar-sub-header"><a href="/md/assembly/middleware/%E7%BB%9F%E4%B8%80%E7%99%BD%E5%90%8D%E5%8D%95%E7%BB%84%E4%BB%B6.html#_2ã€dojoinpoint" class="toc-sidebar-link">2ã€DoJoinPoint</a></li><li class="toc-sidebar-sub-header"><a href="/md/assembly/middleware/%E7%BB%9F%E4%B8%80%E7%99%BD%E5%90%8D%E5%8D%95%E7%BB%84%E4%BB%B6.html#_3ã€whitelistproperties" class="toc-sidebar-link">3ã€WhiteListProperties</a></li><li class="toc-sidebar-sub-header"><a href="/md/assembly/middleware/%E7%BB%9F%E4%B8%80%E7%99%BD%E5%90%8D%E5%8D%95%E7%BB%84%E4%BB%B6.html#_4ã€whitelistautoconfigure" class="toc-sidebar-link">4ã€WhiteListAutoConfigure</a></li></ul></li><li><a href="/md/assembly/middleware/%E7%BB%9F%E4%B8%80%E7%99%BD%E5%90%8D%E5%8D%95%E7%BB%84%E4%BB%B6.html#_4ã€éªŒè¯" class="toc-sidebar-link">4ã€éªŒè¯</a><ul class="toc-sidebar-sub-headers"></ul></li></ul></div></div></div></div></div> <div class="option-box"><img src="/images/system/github.png" width="28px" class="nozoom"> <span class="show-txt">Github</span></div> <div class="option-box"><img src="/images/system/gitee.png" width="28px" class="nozoom"> <span class="show-txt">Gitee</span></div> <div class="option-box"><img src="/images/system/left.png" width="28px" class="nozoom"> <span class="show-txt">å·¦æ </span></div> <!----> <!----></div>  <!----> </aside></div><div class="global-ui"><LockArticle></LockArticle><PayArticle></PayArticle></div></div>
    <script src="/assets/js/cg-styles.js?v=1686664442105" defer></script><script src="/assets/js/cg-3.js?v=1686664442105" defer></script><script src="/assets/js/cg-4.js?v=1686664442105" defer></script><script src="/assets/js/cg-10.js?v=1686664442105" defer></script><script src="/assets/js/cg-app.js?v=1686664442105" defer></script>
  </body>
</html>

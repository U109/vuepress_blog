<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>é¢ç»æ‰‹å†Œ Â· ç¬¬21ç¯‡ã€Šæ‰‹å†™çº¿ç¨‹æ± ï¼Œå¯¹ç…§å­¦ä¹ ThreadPoolExecutorçº¿ç¨‹æ± å®ç°åŸç†ï¼ã€‹ | bugstack è™«æ´æ ˆ</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/favicon.ico">
    <script charset="utf-8" async="async" src="/js/jquery.min.js"></script>
    <script charset="utf-8" async="async" src="/js/global.js"></script>
    <script charset="utf-8" async="async" src="/js/fingerprint2.min.js"></script>
    <script>
              var _hmt = _hmt || [];
              (function() {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?0b31b4c146bf7126aed5009e1a4a11c8";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
              })();
            </script>
    <meta name="description" content="åŒ…å«: Java åŸºç¡€ï¼Œé¢ç»æ‰‹å†Œï¼ŒNetty4.xï¼Œæ‰‹å†™Springï¼Œç”¨Javaå®ç°JVMï¼Œé‡å­¦Javaè®¾è®¡æ¨¡å¼ï¼ŒSpringBootä¸­é—´ä»¶å¼€å‘ï¼ŒIDEAæ’ä»¶å¼€å‘ï¼ŒDDDç³»ç»Ÿæ¶æ„é¡¹ç›®å¼€å‘ï¼Œå­—èŠ‚ç ç¼–ç¨‹...">
    <meta property="og:title" content="é¢ç»æ‰‹å†Œ Â· ç¬¬21ç¯‡ã€Šæ‰‹å†™çº¿ç¨‹æ± ï¼Œå¯¹ç…§å­¦ä¹ ThreadPoolExecutorçº¿ç¨‹æ± å®ç°åŸç†ï¼ã€‹">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/md/java/interview/2020-12-09-%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C%20%C2%B7%20%E7%AC%AC21%E7%AF%87%E3%80%8A%E6%89%8B%E5%86%99%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%8C%E5%AF%B9%E7%85%A7%E5%AD%A6%E4%B9%A0ThreadPoolExecutor%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%EF%BC%81%E3%80%8B.html">
    <meta name="twitter:title" content="é¢ç»æ‰‹å†Œ Â· ç¬¬21ç¯‡ã€Šæ‰‹å†™çº¿ç¨‹æ± ï¼Œå¯¹ç…§å­¦ä¹ ThreadPoolExecutorçº¿ç¨‹æ± å®ç°åŸç†ï¼ã€‹">
    <meta name="twitter:url" content="/md/java/interview/2020-12-09-%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C%20%C2%B7%20%E7%AC%AC21%E7%AF%87%E3%80%8A%E6%89%8B%E5%86%99%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%8C%E5%AF%B9%E7%85%A7%E5%AD%A6%E4%B9%A0ThreadPoolExecutor%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%EF%BC%81%E3%80%8B.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="robots" content="all">
    <meta name="author" content="å°å‚…å“¥">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="keywords" content="bugstack è™«æ´æ ˆ, DDDæŠ½å¥–ç³»ç»Ÿï¼Œæ•°æ®ç»“æ„ï¼Œé‡å­¦Javaè®¾è®¡æ¨¡å¼, å­—èŠ‚ç ç¼–ç¨‹, ä¸­é—´ä»¶, æ‰‹å†™Spring, æ‰‹å†™MyBatisï¼ŒJavaåŸºç¡€, é¢ç»æ‰‹å†Œï¼Œé¢è¯•é¢˜ï¼ŒAPIç½‘å…³ï¼ŒSpringBoot Stater">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="preload" href="/assets/css/0.styles.1cf1ed91.css" as="style"><link rel="preload" href="/assets/css/styles.css?v=1686842317929" as="style"><link rel="preload" href="/assets/js/cg-styles.js?v=1686842317929" as="script"><link rel="preload" href="/assets/js/cg-app.js?v=1686842317929" as="script"><link rel="preload" href="/assets/js/cg-3.js?v=1686842317929" as="script"><link rel="preload" href="/assets/js/cg-4.js?v=1686842317929" as="script"><link rel="preload" href="/assets/js/cg-51.js?v=1686842317929" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.1cf1ed91.css"><link rel="stylesheet" href="/assets/css/styles.css?v=1686842317929">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">bugstack è™«æ´æ ˆ</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/java/interview/2020-07-28-é¢ç»æ‰‹å†Œ Â· å¼€ç¯‡ã€Šé¢è¯•å®˜éƒ½é—®æˆ‘å•¥ã€‹.html" class="nav-link">
  é¢ç»æ‰‹å†Œ
</a></li><li class="dropdown-item"><!----> <a href="/md/java/develop-jvm/2019-05-01-ç”¨Javaå®ç°JVMç¬¬ä¸€ç« ã€Šå‘½ä»¤è¡Œå·¥å…·ã€‹.html" class="nav-link">
  ç”¨Javaå®ç°JVM
</a></li><li class="dropdown-item"><!----> <a href="/md/java/core/2020-01-06-[æºç åˆ†æ]å’‹å˜ï¼Ÿä½ çš„IDEAè¿‡æœŸäº†å§ï¼åŠ ä¸ªJaråŒ…å°±ç ´è§£äº†ï¼Œä¸ºä»€ä¹ˆï¼Ÿ.html" class="nav-link">
  åŸºç¡€æŠ€æœ¯
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Netty" class="dropdown-title"><span class="title">Netty</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/netty/basics/NIOåŸºç¡€ï¼šä¸‰å¤§ç»„ä»¶.html" class="nav-link">
  NettyåŸºç¡€ç¯‡
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ä¸­é—´ä»¶" class="dropdown-title"><span class="title">ä¸­é—´ä»¶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/assembly/middleware/ç»Ÿä¸€ç™½åå•ç»„ä»¶.html" class="nav-link">
  springbootä¸­é—´ä»¶
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/java/interview/2020-07-28-é¢ç»æ‰‹å†Œ Â· å¼€ç¯‡ã€Šé¢è¯•å®˜éƒ½é—®æˆ‘å•¥ã€‹.html" class="nav-link">
  é¢ç»æ‰‹å†Œ
</a></li><li class="dropdown-item"><!----> <a href="/md/java/develop-jvm/2019-05-01-ç”¨Javaå®ç°JVMç¬¬ä¸€ç« ã€Šå‘½ä»¤è¡Œå·¥å…·ã€‹.html" class="nav-link">
  ç”¨Javaå®ç°JVM
</a></li><li class="dropdown-item"><!----> <a href="/md/java/core/2020-01-06-[æºç åˆ†æ]å’‹å˜ï¼Ÿä½ çš„IDEAè¿‡æœŸäº†å§ï¼åŠ ä¸ªJaråŒ…å°±ç ´è§£äº†ï¼Œä¸ºä»€ä¹ˆï¼Ÿ.html" class="nav-link">
  åŸºç¡€æŠ€æœ¯
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Netty" class="dropdown-title"><span class="title">Netty</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/netty/basics/NIOåŸºç¡€ï¼šä¸‰å¤§ç»„ä»¶.html" class="nav-link">
  NettyåŸºç¡€ç¯‡
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ä¸­é—´ä»¶" class="dropdown-title"><span class="title">ä¸­é—´ä»¶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/assembly/middleware/ç»Ÿä¸€ç™½åå•ç»„ä»¶.html" class="nav-link">
  springbootä¸­é—´ä»¶
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ç¬¬ 1 ç«  è°ˆè°ˆé¢è¯•</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/java/interview/2020-07-28-é¢ç»æ‰‹å†Œ Â· å¼€ç¯‡ã€Šé¢è¯•å®˜éƒ½é—®æˆ‘å•¥ã€‹.html" class="sidebar-link">é¢ç»æ‰‹å†Œ Â· å¼€ç¯‡ã€Šé¢è¯•å®˜éƒ½é—®æˆ‘å•¥ã€‹</a></li><li><a href="/md/java/interview/2020-07-30-é¢ç»æ‰‹å†Œ Â· ç¬¬1ç¯‡ã€Šè®¤çŸ¥è‡ªå·±çš„æŠ€æœ¯æ ˆç›²åŒºã€‹.html" class="sidebar-link">é¢ç»æ‰‹å†Œ Â· ç¬¬1ç¯‡ã€Šè®¤çŸ¥è‡ªå·±çš„æŠ€æœ¯æ ˆç›²åŒºã€‹</a></li><li><a href="/md/java/interview/2021-03-07-é¢è¯•ç°åœºï¼šå°ä¼™ä¼´ç¾å›¢ä¸€é¢çš„åˆ†äº«å’Œåˆ†æ[å«è§£ç­”].html" class="sidebar-link">é¢è¯•ç°åœºï¼šå°ä¼™ä¼´ç¾å›¢ä¸€é¢çš„åˆ†äº«å’Œåˆ†æ(å«è§£ç­”)</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ç¬¬ 2 ç«  æ•°æ®ç»“æ„å’Œç®—æ³•</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/java/interview/2020-08-04-é¢ç»æ‰‹å†Œ Â· ç¬¬2ç¯‡ã€Šæ•°æ®ç»“æ„ï¼ŒHashCodeä¸ºä»€ä¹ˆä½¿ç”¨31ä½œä¸ºä¹˜æ•°ï¼Ÿã€‹.html" class="sidebar-link">é¢ç»æ‰‹å†Œ Â· ç¬¬2ç¯‡ã€Šæ•°æ®ç»“æ„ï¼ŒHashCodeä¸ºä»€ä¹ˆä½¿ç”¨31ä½œä¸ºä¹˜æ•°ï¼Ÿã€‹</a></li><li><a href="/md/java/interview/2020-08-07-é¢ç»æ‰‹å†Œ Â· ç¬¬3ç¯‡ã€ŠHashMapæ ¸å¿ƒçŸ¥è¯†ï¼Œæ‰°åŠ¨å‡½æ•°ã€è´Ÿè½½å› å­ã€æ‰©å®¹é“¾è¡¨æ‹†åˆ†ï¼Œæ·±åº¦å­¦ä¹ ã€‹.html" class="sidebar-link">é¢ç»æ‰‹å†Œ Â· ç¬¬3ç¯‡ã€ŠHashMapæ ¸å¿ƒçŸ¥è¯†ï¼Œæ‰°åŠ¨å‡½æ•°ã€è´Ÿè½½å› å­ã€æ‰©å®¹é“¾è¡¨æ‹†åˆ†ï¼Œæ·±åº¦å­¦ä¹ ã€‹</a></li><li><a href="/md/java/interview/2020-08-13-é¢ç»æ‰‹å†Œ Â· ç¬¬4ç¯‡ã€ŠHashMapæ•°æ®æ’å…¥ã€æŸ¥æ‰¾ã€åˆ é™¤ã€éå†ï¼Œæºç åˆ†æã€‹.html" class="sidebar-link">é¢ç»æ‰‹å†Œ Â· ç¬¬4ç¯‡ã€ŠHashMapæ•°æ®æ’å…¥ã€æŸ¥æ‰¾ã€åˆ é™¤ã€éå†ï¼Œæºç åˆ†æã€‹</a></li><li><a href="/md/java/interview/2020-08-16-é¢ç»æ‰‹å†Œ Â· ç¬¬5ç¯‡ã€Šçœ‹å›¾è¯´è¯ï¼Œè®²è§£2-3å¹³è¡¡æ ‘ã€Œçº¢é»‘æ ‘çš„å‰èº«ã€ã€‹.html" class="sidebar-link">é¢ç»æ‰‹å†Œ Â· ç¬¬5ç¯‡ã€Šçœ‹å›¾è¯´è¯ï¼Œè®²è§£2-3å¹³è¡¡æ ‘ã€Œçº¢é»‘æ ‘çš„å‰èº«ã€ã€‹</a></li><li><a href="/md/java/interview/2020-08-20-é¢ç»æ‰‹å†Œ Â· ç¬¬6ç¯‡ã€Šå¸¦ç€é¢è¯•é¢˜å­¦ä¹ çº¢é»‘æ ‘æ“ä½œåŸç†ï¼Œè§£æä»€ä¹ˆæ—¶å€™æŸ“è‰²ã€æ€ä¹ˆè¿›è¡Œæ—‹è½¬ã€ä¸2-3æ ‘æœ‰ä»€ä¹ˆå…³è”ã€‹.html" class="sidebar-link">é¢ç»æ‰‹å†Œ Â· ç¬¬6ç¯‡ã€Šå¸¦ç€é¢è¯•é¢˜å­¦ä¹ çº¢é»‘æ ‘æ“ä½œåŸç†ï¼Œè§£æä»€ä¹ˆæ—¶å€™æŸ“è‰²ã€æ€ä¹ˆè¿›è¡Œæ—‹è½¬ã€ä¸2-3æ ‘æœ‰ä»€ä¹ˆå…³è”ã€‹</a></li><li><a href="/md/java/interview/2020-08-27-é¢ç»æ‰‹å†Œ Â· ç¬¬7ç¯‡ã€ŠArrayListä¹Ÿè¿™ä¹ˆå¤šçŸ¥è¯†ï¼Ÿä¸€ä¸ªæŒ‡å®šä½ç½®æ’å…¥å°±æŠŠè°¢é£æœºé¢æ™•äº†ï¼ã€‹.html" class="sidebar-link">é¢ç»æ‰‹å†Œ Â· ç¬¬7ç¯‡ã€ŠArrayListä¹Ÿè¿™ä¹ˆå¤šçŸ¥è¯†ï¼Ÿä¸€ä¸ªæŒ‡å®šä½ç½®æ’å…¥å°±æŠŠè°¢é£æœºé¢æ™•äº†ï¼ã€‹</a></li><li><a href="/md/java/interview/2020-08-30-é¢ç»æ‰‹å†Œ Â· ç¬¬8ç¯‡ã€ŠLinkedListæ’å…¥é€Ÿåº¦æ¯”ArrayListå¿«ï¼Ÿä½ ç¡®å®šå—ï¼Ÿã€‹.html" class="sidebar-link">é¢ç»æ‰‹å†Œ Â· ç¬¬8ç¯‡ã€ŠLinkedListæ’å…¥é€Ÿåº¦æ¯”ArrayListå¿«ï¼Ÿä½ ç¡®å®šå—ï¼Ÿã€‹</a></li><li><a href="/md/java/interview/2020-09-03-é¢ç»æ‰‹å†Œ Â· ç¬¬9ç¯‡ã€Šé˜Ÿåˆ—æ˜¯ä»€ä¹ˆï¼Ÿä»€ä¹ˆæ˜¯åŒç«¯é˜Ÿåˆ—ã€å»¶è¿Ÿå¯¹åˆ—ã€é˜»å¡é˜Ÿåˆ—ï¼Œå…¨æ˜¯çŸ¥è¯†ç›²åŒºï¼ã€‹.html" class="sidebar-link">é¢ç»æ‰‹å†Œ Â· ç¬¬9ç¯‡ã€Šé˜Ÿåˆ—æ˜¯ä»€ä¹ˆï¼Ÿä»€ä¹ˆæ˜¯åŒç«¯é˜Ÿåˆ—ã€å»¶è¿Ÿå¯¹åˆ—ã€é˜»å¡é˜Ÿåˆ—ï¼Œå…¨æ˜¯çŸ¥è¯†ç›²åŒºï¼ã€‹</a></li><li><a href="/md/java/interview/2020-09-10-é¢ç»æ‰‹å†Œ Â· ç¬¬10ç¯‡ã€Šæ‰«ç›²java.util.Collectionså·¥å…·åŒ…ï¼Œå­¦ä¹ æ’åºã€äºŒåˆ†ã€æ´—ç‰Œã€æ—‹è½¬ç®—æ³•ã€‹.html" class="sidebar-link">é¢ç»æ‰‹å†Œ Â· ç¬¬10ç¯‡ã€Šæ‰«ç›²java.util.Collectionså·¥å…·åŒ…ï¼Œå­¦ä¹ æ’åºã€äºŒåˆ†ã€æ´—ç‰Œã€æ—‹è½¬ç®—æ³•ã€‹</a></li><li><a href="/md/java/interview/2020-09-17-é¢ç»æ‰‹å†Œ Â· ç¬¬11ç¯‡ã€ŠStringBuilder æ¯” String å¿«ï¼Ÿç©ºå˜´ç™½ç‰™çš„ï¼Œè¯æ®å‘¢ï¼ã€‹.html" class="sidebar-link">é¢ç»æ‰‹å†Œ Â· ç¬¬11ç¯‡ã€ŠStringBuilder æ¯” String å¿«ï¼Ÿç©ºå˜´ç™½ç‰™çš„ï¼Œè¯æ®å‘¢ï¼ã€‹</a></li><li><a href="/md/java/interview/2020-09-23-é¢ç»æ‰‹å†Œ Â· ç¬¬12ç¯‡ã€Šé¢è¯•å®˜ï¼ŒThreadLocal ä½ è¦è¿™ä¹ˆé—®ï¼Œæˆ‘å°±æŒ‚äº†ï¼ã€‹.html" class="sidebar-link">é¢ç»æ‰‹å†Œ Â· ç¬¬12ç¯‡ã€Šé¢è¯•å®˜ï¼ŒThreadLocal ä½ è¦è¿™ä¹ˆé—®ï¼Œæˆ‘å°±æŒ‚äº†ï¼ã€‹</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ç¬¬ 3 ç«  å¹¶å‘å’Œé”</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/java/interview/2020-10-14-é¢ç»æ‰‹å†Œ Â· ç¬¬13ç¯‡ã€Šé™¤äº†JDKã€CGLIBï¼Œè¿˜æœ‰3ç§ç±»ä»£ç†æ–¹å¼ï¼Ÿé¢è¯•åˆå¡ä½ï¼ã€‹.html" class="sidebar-link">é¢ç»æ‰‹å†Œ Â· ç¬¬13ç¯‡ã€Šé™¤äº†JDKã€CGLIBï¼Œè¿˜æœ‰3ç§ç±»ä»£ç†æ–¹å¼ï¼Ÿé¢è¯•åˆå¡ä½ï¼ã€‹</a></li><li><a href="/md/java/interview/2020-10-21-é¢ç»æ‰‹å†Œ Â· ç¬¬14ç¯‡ã€Švolatile æ€ä¹ˆå®ç°çš„å†…å­˜å¯è§ï¼Ÿæ²¡æœ‰ volatile ä¸€å®šä¸å¯è§å—ï¼Ÿã€‹.html" class="sidebar-link">é¢ç»æ‰‹å†Œ Â· ç¬¬14ç¯‡ã€Švolatile æ€ä¹ˆå®ç°çš„å†…å­˜å¯è§ï¼Ÿæ²¡æœ‰ volatile ä¸€å®šä¸å¯è§å—ï¼Ÿã€‹</a></li><li><a href="/md/java/interview/2020-10-28-é¢ç»æ‰‹å†Œ Â· ç¬¬15ç¯‡ã€Šç å†œä¼šé”ï¼Œsynchronized è§£æ¯’ï¼Œå‰–ææºç æ·±åº¦åˆ†æï¼ã€‹.html" class="sidebar-link">é¢ç»æ‰‹å†Œ Â· ç¬¬15ç¯‡ã€Šç å†œä¼šé”ï¼Œsynchronized è§£æ¯’ï¼Œå‰–ææºç æ·±åº¦åˆ†æï¼ã€‹</a></li><li><a href="/md/java/interview/2020-11-04-é¢ç»æ‰‹å†Œ Â· ç¬¬16ç¯‡ã€Šç å†œä¼šé”ï¼ŒReentrantLockä¹‹å…¬å¹³é”è®²è§£å’Œå®ç°ã€‹.html" class="sidebar-link">é¢ç»æ‰‹å†Œ Â· ç¬¬16ç¯‡ã€Šç å†œä¼šé”ï¼ŒReentrantLockä¹‹å…¬å¹³é”è®²è§£å’Œå®ç°ã€‹</a></li><li><a href="/md/java/interview/2020-11-11-é¢ç»æ‰‹å†Œ Â· ç¬¬17ç¯‡ã€Šç å†œä¼šé”ï¼ŒReentrantLockä¹‹AQSåŸç†åˆ†æå’Œå®è·µä½¿ç”¨ã€‹.html" class="sidebar-link">é¢ç»æ‰‹å†Œ Â· ç¬¬17ç¯‡ã€Šç å†œä¼šé”ï¼ŒReentrantLockä¹‹AQSåŸç†åˆ†æå’Œå®è·µä½¿ç”¨ã€‹</a></li><li><a href="/md/java/interview/2020-11-18-é¢ç»æ‰‹å†Œ Â· ç¬¬18ç¯‡ã€ŠAQS å…±äº«é”ï¼ŒSemaphoreã€CountDownLatchï¼Œå¬è¯´æ•°æ®åº“è¿æ¥æ± å¯ä»¥ç”¨åˆ°ï¼ã€‹.html" class="sidebar-link">é¢ç»æ‰‹å†Œ Â· ç¬¬18ç¯‡ã€ŠAQS å…±äº«é”ï¼ŒSemaphoreã€CountDownLatchï¼Œå¬è¯´æ•°æ®åº“è¿æ¥æ± å¯ä»¥ç”¨åˆ°ï¼ã€‹</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>ç¬¬ 4 ç«  å¤šçº¿ç¨‹</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/java/interview/2020-11-25-é¢ç»æ‰‹å†Œ Â· ç¬¬19ç¯‡ã€ŠThread.start() ï¼Œå®ƒæ˜¯æ€ä¹ˆè®©çº¿ç¨‹å¯åŠ¨çš„å‘¢ï¼Ÿã€‹.html" class="sidebar-link">é¢ç»æ‰‹å†Œ Â· ç¬¬19ç¯‡ã€ŠThread.start() ï¼Œå®ƒæ˜¯æ€ä¹ˆè®©çº¿ç¨‹å¯åŠ¨çš„å‘¢ï¼Ÿã€‹</a></li><li><a href="/md/java/interview/2020-12-02-é¢ç»æ‰‹å†Œ Â· ç¬¬20ç¯‡ã€ŠThread çº¿ç¨‹ï¼ŒçŠ¶æ€è½¬æ¢ã€æ–¹æ³•ä½¿ç”¨ã€åŸç†åˆ†æã€‹.html" class="sidebar-link">é¢ç»æ‰‹å†Œ Â· ç¬¬20ç¯‡ã€ŠThread çº¿ç¨‹ï¼ŒçŠ¶æ€è½¬æ¢ã€æ–¹æ³•ä½¿ç”¨ã€åŸç†åˆ†æã€‹</a></li><li><a href="/md/java/interview/2020-12-09-é¢ç»æ‰‹å†Œ Â· ç¬¬21ç¯‡ã€Šæ‰‹å†™çº¿ç¨‹æ± ï¼Œå¯¹ç…§å­¦ä¹ ThreadPoolExecutorçº¿ç¨‹æ± å®ç°åŸç†ï¼ã€‹.html" class="active sidebar-link">é¢ç»æ‰‹å†Œ Â· ç¬¬21ç¯‡ã€Šæ‰‹å†™çº¿ç¨‹æ± ï¼Œå¯¹ç…§å­¦ä¹ ThreadPoolExecutorçº¿ç¨‹æ± å®ç°åŸç†ï¼ã€‹</a></li><li><a href="/md/java/interview/2020-12-16-é¢ç»æ‰‹å†Œ Â· ç¬¬22ç¯‡ã€Šçº¿ç¨‹æ± çš„ä»‹ç»å’Œä½¿ç”¨ï¼Œä»¥åŠåŸºäºjvmtiè®¾è®¡éå…¥ä¾µç›‘æ§ã€‹.html" class="sidebar-link">é¢ç»æ‰‹å†Œ Â· ç¬¬22ç¯‡ã€Šçº¿ç¨‹æ± çš„ä»‹ç»å’Œä½¿ç”¨ï¼Œä»¥åŠåŸºäºjvmtiè®¾è®¡éå…¥ä¾µç›‘æ§ã€‹</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ç¬¬ 5 ç«  JVM è™šæ‹Ÿæœº</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/java/interview/2020-12-23-é¢ç»æ‰‹å†Œ Â· ç¬¬23ç¯‡ã€ŠJDKã€JREã€JVMï¼Œæ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿã€‹.html" class="sidebar-link">é¢ç»æ‰‹å†Œ Â· ç¬¬23ç¯‡ã€ŠJDKã€JREã€JVMï¼Œæ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿã€‹</a></li><li><a href="/md/java/interview/2020-12-30-é¢ç»æ‰‹å†Œ Â· ç¬¬24ç¯‡ã€Šä¸ºäº†ææ¸…æ¥šç±»åŠ è½½ï¼Œç«Ÿç„¶æ‰‹æ’¸JVMï¼ã€‹.html" class="sidebar-link">é¢ç»æ‰‹å†Œ Â· ç¬¬24ç¯‡ã€Šä¸ºäº†ææ¸…æ¥šç±»åŠ è½½ï¼Œç«Ÿç„¶æ‰‹æ’¸JVMï¼ã€‹</a></li><li><a href="/md/java/interview/2021-01-06-é¢ç»æ‰‹å†Œ Â· ç¬¬25ç¯‡ã€ŠJVMå†…å­˜æ¨¡å‹æ€»ç»“ï¼Œæœ‰å„ç‰ˆæœ¬JDKå¯¹æ¯”ã€æœ‰å…ƒç©ºé—´OOMç›‘æ§æ¡ˆä¾‹ã€æœ‰Javaç‰ˆè™šæ‹Ÿæœºï¼Œç»¼åˆå­¦ä¹ æ›´å®¹æ˜“ï¼ã€‹.html" class="sidebar-link">é¢ç»æ‰‹å†Œ Â· ç¬¬25ç¯‡ã€ŠJVMå†…å­˜æ¨¡å‹æ€»ç»“ï¼Œæœ‰å„ç‰ˆæœ¬JDKå¯¹æ¯”ã€æœ‰å…ƒç©ºé—´OOMç›‘æ§æ¡ˆä¾‹ã€æœ‰Javaç‰ˆè™šæ‹Ÿæœºï¼Œç»¼åˆå­¦ä¹ æ›´å®¹æ˜“ï¼ã€‹</a></li><li><a href="/md/java/interview/2021-01-13-é¢ç»æ‰‹å†Œ Â· ç¬¬26ç¯‡ã€ŠJVMæ•…éšœå¤„ç†å·¥å…·ï¼Œä½¿ç”¨æ€»ç»“ã€‹.html" class="sidebar-link">é¢ç»æ‰‹å†Œ Â· ç¬¬26ç¯‡ã€ŠJVMæ•…éšœå¤„ç†å·¥å…·ï¼Œä½¿ç”¨æ€»ç»“ã€‹</a></li><li><a href="/md/java/interview/2021-01-20-é¢ç»æ‰‹å†Œ Â· ç¬¬27ç¯‡ã€ŠJVM åˆ¤æ–­å¯¹è±¡å·²æ­»ï¼Œå®è·µéªŒè¯GCå›æ”¶ã€‹.html" class="sidebar-link">é¢ç»æ‰‹å†Œ Â· ç¬¬27ç¯‡ã€ŠJVM åˆ¤æ–­å¯¹è±¡å·²æ­»ï¼Œå®è·µéªŒè¯GCå›æ”¶ã€‹</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ç¬¬ 6 ç«  Spring</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/java/interview/2021-03-30-é¢ç»æ‰‹å†Œ Â· ç¬¬28ç¯‡ã€Šä½ è¯´ï¼Œæ€ä¹ˆæŠŠBeanå¡åˆ°Springå®¹å™¨ã€‹.html" class="sidebar-link">é¢ç»æ‰‹å†Œ Â· ç¬¬28ç¯‡ã€Šä½ è¯´ï¼Œæ€ä¹ˆæŠŠBeanå¡åˆ°Springå®¹å™¨ï¼Ÿã€‹</a></li><li><a href="/md/java/interview/2021-04-07-é¢ç»æ‰‹å†Œ Â· ç¬¬29ç¯‡ã€ŠSpring IOC ç‰¹æ€§æœ‰å“ªäº›ï¼Œä¸ä¼šè¯»ä¸æ‡‚æºç ï¼ã€‹.html" class="sidebar-link">é¢ç»æ‰‹å†Œ Â· ç¬¬29ç¯‡ã€ŠSpring IOC ç‰¹æ€§æœ‰å“ªäº›ï¼Œä¸ä¼šè¯»ä¸æ‡‚æºç ï¼ã€‹</a></li><li><a href="/md/java/interview/2021-04-18-é¢ç»æ‰‹å†Œ Â· ç¬¬30ç¯‡ã€Šå…³äº Spring ä¸­ getBean çš„å…¨æµç¨‹æºç è§£æã€‹.html" class="sidebar-link">é¢ç»æ‰‹å†Œ Â· ç¬¬30ç¯‡ã€Šå…³äº Spring ä¸­ getBean çš„å…¨æµç¨‹æºç è§£æã€‹</a></li><li><a href="/md/java/interview/2021-05-05-é¢ç»æ‰‹å†Œ Â· ç¬¬31ç¯‡ã€ŠSpring Bean IOCã€AOP å¾ªç¯ä¾èµ–è§£è¯»ã€‹.html" class="sidebar-link">é¢ç»æ‰‹å†Œ Â· ç¬¬31ç¯‡ã€ŠSpring Bean IOCã€AOP å¾ªç¯ä¾èµ–è§£è¯»ã€‹</a></li></ul></section></li></ul> </aside> <div><main class="page"> <div class="theme-default-content content__default"><h1 id="é¢ç»æ‰‹å†Œ-Â·-ç¬¬21ç¯‡ã€Šæ‰‹å†™çº¿ç¨‹æ± -å¯¹ç…§å­¦ä¹ threadpoolexecutorçº¿ç¨‹æ± å®ç°åŸç†-ã€‹"><a href="#é¢ç»æ‰‹å†Œ-Â·-ç¬¬21ç¯‡ã€Šæ‰‹å†™çº¿ç¨‹æ± -å¯¹ç…§å­¦ä¹ threadpoolexecutorçº¿ç¨‹æ± å®ç°åŸç†-ã€‹" class="header-anchor">#</a> é¢ç»æ‰‹å†Œ Â· ç¬¬21ç¯‡ã€Šæ‰‹å†™çº¿ç¨‹æ± ï¼Œå¯¹ç…§å­¦ä¹ ThreadPoolExecutorçº¿ç¨‹æ± å®ç°åŸç†ï¼ã€‹</h1> <p>ä½œè€…ï¼šå°å‚…å“¥
<br>åšå®¢ï¼š<a href="https://bugstack.cn" target="_blank" rel="noopener noreferrer">https://bugstack.cn<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„</p></blockquote> <h2 id="ä¸€ã€å‰è¨€"><a href="#ä¸€ã€å‰è¨€" class="header-anchor">#</a> ä¸€ã€å‰è¨€</h2> <p><code>äººçœ‹æ‰‹æœºï¼Œæœºå™¨å­¦ä¹ ï¼</code></p> <p><img alt="" data-src="https://bugstack.cn/assets/images/2020/interview/interview-21-0.png" loading="lazy" class="lazy"></p> <p>æ­£å¥½æ˜¯2020å¹´ï¼Œçœ‹åˆ°è¿™å¼ å›¾è¿˜æ˜¯è›®æœ‰æ„æ€çš„ã€‚ä»¥å‰å°æ—¶å€™æ€»ä¼šçœ‹åˆ°ä¸€äº›ç§‘æŠ€ç”µå½±ï¼Œè®²åˆ°æœºå™¨äººä¼šæ€æ ·æ€æ ·ï¼Œä½†æ²¡æƒ³åˆ°äººä¼¼ä¹è¢«å¨±ä¹åŒ–çš„ä¸œè¥¿ï¼Œææˆäº†ä½å¤´æ—ã€å¤§è‚šå­ï¼</p> <p>å½“æ„è¯†åˆ°è¿™ä¸€ç‚¹æ—¶ï¼Œå…¶å®éå¸¸æ€€å¿µå°æ—¶å€™ã€‚æ”¾å‡çš„æ—©ä¸Šè·‘å‡ºå»ï¼Œå–Šä¸Šä¸‰äº”ä¸ªä¼™ä¼´ï¼Œè¦ä¸ä¸‹æ²³æ‘¸æ‘¸é±¼ã€å¼¹å¼¹ç»ç’ƒçƒã€æ‰“æ‰“piaã€è·³è·³æˆ¿å­ï¼ä¸€å¤©ä¸‹æ¥çœŸçš„ä¸ä¼šæ„Ÿè§‰ç´¯ï¼Œä½†ç°åœ¨å¦‚æœæ˜¯æ”¾å‡çš„ä¸€å¤©ï¼Œä½ çš„å¨±ä¹å®‰æ’ï¼Œå¾ˆå¤šæ—¶å€™ä¼šè®©å¤´å¾ˆç´¯ï¼</p> <p><strong>å°±åƒ</strong>ï¼Œä½ æœ‰è¯•è¿‡å­¦ä¹ ä¸€å¤©è‹±è¯­å¤´ç–¼ï¼Œè¿˜æ˜¯åˆ·ä¸€å¤©æŠ–éŸ³å¤´ç–¼å—ï¼Ÿæˆ–è€…ç©ä¸€å¤©æ¸¸æˆä¸æ‰“ä¸€å¤©çƒï¼<code>å¦‚æœä½ æ„è¯†åˆ°äº†ï¼Œé‚£ä¹ˆäº‰å–æ”¾ä¸‹ä¸€ä¼šæ‰‹æœºï¼Œé€‚å½“å¨±ä¹ï¼Œé”»ç‚¼ä¿æŒä¸ªå¥½èº«ä½“ï¼</code></p> <h2 id="äºŒã€é¢è¯•é¢˜"><a href="#äºŒã€é¢è¯•é¢˜" class="header-anchor">#</a> äºŒã€é¢è¯•é¢˜</h2> <p><code>è°¢é£æœºï¼Œå°è®°ï¼</code>ï¼Œä¸Šæ¬¡åƒäºåœ¨çº¿ç¨‹ä¸Šï¼Œè¿™æ¬¡å¯èƒ½ä¸€æ¬¡å‘æ‰ä¸¤æ¬¡äº†ï¼</p> <p><strong>è°¢é£æœº</strong>ï¼šä½ é—®å§ï¼Œæˆ‘å‡†å¤‡å¥½äº†ï¼ï¼ï¼</p> <p><strong>é¢è¯•å®˜</strong>ï¼šå—¯ï¼Œçº¿ç¨‹æ± çŠ¶æ€æ˜¯å¦‚ä½•è®¾è®¡å­˜å‚¨çš„ï¼Ÿ</p> <p><strong>è°¢é£æœº</strong>ï¼šè¿™ï¼ä¸‹ä¸€ä¸ªï¼Œä¸‹ä¸€ä¸ªï¼</p> <p><strong>é¢è¯•å®˜</strong>ï¼šWorker çš„å®ç°ç±»ï¼Œä¸ºä»€ä¹ˆä¸ä½¿ç”¨ ReentrantLock æ¥å®ç°å‘¢ï¼Œè€Œæ˜¯è‡ªå·±ç»§æ‰¿AQSï¼Ÿ</p> <p><strong>è°¢é£æœº</strong>ï¼šæˆ‘...ï¼</p> <p><strong>é¢è¯•å®˜</strong>ï¼šé‚£ä½ ç®€è¿°ä¸‹ï¼Œexecute çš„æ‰§è¡Œè¿‡ç¨‹å§ï¼</p> <p><strong>è°¢é£æœº</strong>ï¼šå†è§ï¼</p> <h2 id="ä¸‰ã€çº¿ç¨‹æ± è®²è§£"><a href="#ä¸‰ã€çº¿ç¨‹æ± è®²è§£" class="header-anchor">#</a> ä¸‰ã€çº¿ç¨‹æ± è®²è§£</h2> <h3 id="_1-å…ˆçœ‹ä¸ªä¾‹å­"><a href="#_1-å…ˆçœ‹ä¸ªä¾‹å­" class="header-anchor">#</a> 1. å…ˆçœ‹ä¸ªä¾‹å­</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">ThreadPoolExecutor</span> threadPoolExecutor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MILLISECONDS</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
threadPoolExecutor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hi çº¿ç¨‹æ± ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
threadPoolExecutor<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Executors.newFixedThreadPool(10);</span>
<span class="token comment">// Executors.newCachedThreadPool();</span>
<span class="token comment">// Executors.newScheduledThreadPool(10);</span>
<span class="token comment">// Executors.newSingleThreadExecutor();</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>è¿™æ˜¯ä¸€æ®µç”¨äºåˆ›å»ºçº¿ç¨‹æ± çš„ä¾‹å­ï¼Œç›¸ä¿¡ä½ å·²ç»ç”¨äº†å¾ˆå¤šæ¬¡äº†ã€‚</p> <p>çº¿ç¨‹æ± çš„æ ¸å¿ƒç›®çš„å°±æ˜¯èµ„æºçš„åˆ©ç”¨ï¼Œé¿å…é‡å¤åˆ›å»ºçº¿ç¨‹å¸¦æ¥çš„èµ„æºæ¶ˆè€—ã€‚å› æ­¤å¼•å…¥ä¸€ä¸ªæ± åŒ–æŠ€æœ¯çš„æ€æƒ³ï¼Œé¿å…é‡å¤åˆ›å»ºã€é”€æ¯å¸¦æ¥çš„æ€§èƒ½å¼€é”€ã€‚</p> <p><strong>é‚£ä¹ˆ</strong>ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±é€šè¿‡å®è·µçš„æ–¹å¼åˆ†æä¸‹è¿™ä¸ª<code>æ± å­</code>çš„æ„é€ ï¼Œçœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å¤„ç†<code>çº¿ç¨‹</code>çš„ã€‚</p> <h3 id="_2-æ‰‹å†™ä¸€ä¸ªçº¿ç¨‹æ± "><a href="#_2-æ‰‹å†™ä¸€ä¸ªçº¿ç¨‹æ± " class="header-anchor">#</a> 2. æ‰‹å†™ä¸€ä¸ªçº¿ç¨‹æ± </h3> <h4 id="_2-1-å®ç°æµç¨‹"><a href="#_2-1-å®ç°æµç¨‹" class="header-anchor">#</a> 2.1 å®ç°æµç¨‹</h4> <p>ä¸ºäº†æ›´å¥½çš„ç†è§£å’Œåˆ†æå…³äºçº¿ç¨‹æ± çš„æºç ï¼Œæˆ‘ä»¬å…ˆæ¥æŒ‰ç…§çº¿ç¨‹æ± çš„æ€æƒ³ï¼Œæ‰‹å†™ä¸€ä¸ªéå¸¸ç®€å•çš„çº¿ç¨‹æ± ã€‚</p> <p><em>å…¶å®å¾ˆå¤šæ—¶å€™ä¸€æ®µåŠŸèƒ½ä»£ç çš„æ ¸å¿ƒä¸»é€»è¾‘å¯èƒ½å¹¶æ²¡æœ‰å¤šå¤æ‚ï¼Œä½†ä¸ºäº†è®©æ ¸å¿ƒæµç¨‹é¡ºåˆ©è¿è¡Œï¼Œå°±éœ€è¦é¢å¤–æ·»åŠ å¾ˆå¤šåˆ†æ”¯çš„è¾…åŠ©æµç¨‹ã€‚å°±åƒæˆ‘å¸¸è¯´çš„ï¼Œä¸ºäº†ä¿æŠ¤æ‰‹æ‰æŠŠæ“¦å±å±çº¸å¼„é‚£ä¹ˆå¤§ï¼</em></p> <p><img alt="å›¾ 21-1 çº¿ç¨‹æ± ç®€åŒ–æµç¨‹" data-src="https://bugstack.cn/assets/images/2020/interview/interview-21-1.png" loading="lazy" class="lazy"></p> <p>å…³äºå›¾ 21-1ï¼Œè¿™ä¸ªæ‰‹å†™çº¿ç¨‹æ± çš„å®ç°ä¹Ÿéå¸¸ç®€å•ï¼Œåªä¼šä½“ç°å‡ºæ ¸å¿ƒæµç¨‹ï¼ŒåŒ…æ‹¬ï¼š</p> <ol><li>æœ‰nä¸ªä¸€ç›´åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Œç›¸å½“äºæˆ‘ä»¬åˆ›å»ºçº¿ç¨‹æ± æ—¶å…è®¸çš„çº¿ç¨‹æ± å¤§å°ã€‚</li> <li>æŠŠçº¿ç¨‹æäº¤ç»™çº¿ç¨‹æ± è¿è¡Œã€‚</li> <li>å¦‚æœè¿è¡Œçº¿ç¨‹æ± å·²æ»¡ï¼Œåˆ™æŠŠçº¿ç¨‹æ”¾å…¥é˜Ÿåˆ—ä¸­ã€‚</li> <li>æœ€åå½“æœ‰ç©ºé—²æ—¶ï¼Œåˆ™è·å–é˜Ÿåˆ—ä¸­çº¿ç¨‹è¿›è¡Œè¿è¡Œã€‚</li></ol> <h4 id="_2-2-å®ç°ä»£ç "><a href="#_2-2-å®ç°ä»£ç " class="header-anchor">#</a> 2.2 å®ç°ä»£ç </h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadPoolTrader</span> <span class="token keyword">implements</span> <span class="token class-name">Executor</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AtomicInteger</span> ctl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">int</span> corePoolSize<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span> workQueue<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ThreadPoolTrader</span><span class="token punctuation">(</span><span class="token keyword">int</span> corePoolSize<span class="token punctuation">,</span> <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">,</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span> workQueue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>corePoolSize <span class="token operator">=</span> corePoolSize<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>maximumPoolSize <span class="token operator">=</span> maximumPoolSize<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>workQueue <span class="token operator">=</span> workQueue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> command<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> c <span class="token operator">=</span> ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">&lt;</span> corePoolSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">addWorker</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>workQueue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">addWorker</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">addWorker</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> firstTask<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> maximumPoolSize<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

        <span class="token class-name">Worker</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span>firstTask<span class="token punctuation">)</span><span class="token punctuation">;</span>
        worker<span class="token punctuation">.</span>thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctl<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Worker</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>

        <span class="token keyword">final</span> <span class="token class-name">Thread</span> thread<span class="token punctuation">;</span>
        <span class="token class-name">Runnable</span> firstTask<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> firstTask<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>firstTask <span class="token operator">=</span> firstTask<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Runnable</span> task <span class="token operator">=</span> firstTask<span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span>task <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token punctuation">(</span>task <span class="token operator">=</span> <span class="token function">getTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    task<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> maximumPoolSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    task <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                ctl<span class="token punctuation">.</span><span class="token function">decrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token class-name">Runnable</span> <span class="token function">getTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;workQueue.sizeï¼š&quot;</span> <span class="token operator">+</span> workQueue<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> workQueue<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Errorï¼ctl.countï¼š&quot;</span> <span class="token operator">+</span> ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; workQueue.sizeï¼š&quot;</span> <span class="token operator">+</span> workQueue<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ThreadPoolTrader</span> threadPoolTrader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolTrader</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> finalI <span class="token operator">=</span> i<span class="token punctuation">;</span>
            threadPoolTrader<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡ç¼–å·ï¼š&quot;</span> <span class="token operator">+</span> finalI<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token comment">// æµ‹è¯•ç»“æœ</span>

ä»»åŠ¡ç¼–å·ï¼š<span class="token number">1</span>
ä»»åŠ¡ç¼–å·ï¼š<span class="token number">0</span>
workQueue<span class="token punctuation">.</span>sizeï¼š<span class="token number">8</span>
workQueue<span class="token punctuation">.</span>sizeï¼š<span class="token number">8</span>
ä»»åŠ¡ç¼–å·ï¼š<span class="token number">3</span>
workQueue<span class="token punctuation">.</span>sizeï¼š<span class="token number">6</span>
ä»»åŠ¡ç¼–å·ï¼š<span class="token number">2</span>
workQueue<span class="token punctuation">.</span>sizeï¼š<span class="token number">5</span>
ä»»åŠ¡ç¼–å·ï¼š<span class="token number">5</span>
workQueue<span class="token punctuation">.</span>sizeï¼š<span class="token number">4</span>
ä»»åŠ¡ç¼–å·ï¼š<span class="token number">4</span>
workQueue<span class="token punctuation">.</span>sizeï¼š<span class="token number">3</span>
ä»»åŠ¡ç¼–å·ï¼š<span class="token number">7</span>
workQueue<span class="token punctuation">.</span>sizeï¼š<span class="token number">2</span>
ä»»åŠ¡ç¼–å·ï¼š<span class="token number">6</span>
workQueue<span class="token punctuation">.</span>sizeï¼š<span class="token number">1</span>
ä»»åŠ¡ç¼–å·ï¼š<span class="token number">8</span>
ä»»åŠ¡ç¼–å·ï¼š<span class="token number">9</span>
workQueue<span class="token punctuation">.</span>sizeï¼š<span class="token number">0</span>
workQueue<span class="token punctuation">.</span>sizeï¼š<span class="token number">0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br></div></div><p><strong>ä»¥ä¸Š</strong>ï¼Œå…³äºçº¿ç¨‹æ± çš„å®ç°è¿˜æ˜¯éå¸¸ç®€å•çš„ï¼Œä»æµ‹è¯•ç»“æœä¸Šå·²ç»å¯ä»¥æŠŠæœ€æ ¸å¿ƒçš„æ± åŒ–æ€æƒ³ä½“ç°å‡ºæ¥äº†ã€‚ä¸»è¦åŠŸèƒ½é€»è¾‘åŒ…æ‹¬ï¼š</p> <ul><li><code>ctl</code>ï¼Œç”¨äºè®°å½•çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°é‡ã€‚</li> <li><code>corePoolSize</code>ã€<code>maximumPoolSize</code>ï¼Œç”¨äºé™åˆ¶çº¿ç¨‹æ± å®¹é‡ã€‚</li> <li><code>workQueue</code>ï¼Œçº¿ç¨‹æ± é˜Ÿåˆ—ï¼Œä¹Ÿå°±æ˜¯é‚£äº›è¿˜ä¸èƒ½è¢«åŠæ—¶è¿è¡Œçš„çº¿ç¨‹ï¼Œä¼šè¢«è£…å…¥åˆ°è¿™ä¸ªé˜Ÿåˆ—ä¸­ã€‚</li> <li><code>execute</code>ï¼Œç”¨äºæäº¤çº¿ç¨‹ï¼Œè¿™ä¸ªæ˜¯é€šç”¨çš„æ¥å£æ–¹æ³•ã€‚åœ¨è¿™ä¸ªæ–¹æ³•é‡Œä¸»è¦å®ç°çš„å°±æ˜¯ï¼Œå½“å‰æäº¤çš„çº¿ç¨‹æ˜¯åŠ å…¥åˆ°workerã€é˜Ÿåˆ—è¿˜æ˜¯æ”¾å¼ƒã€‚</li> <li><code>addWorker</code>ï¼Œä¸»è¦æ˜¯ç±» <code>Worker</code> çš„å…·ä½“æ“ä½œï¼Œåˆ›å»ºå¹¶æ‰§è¡Œçº¿ç¨‹ã€‚è¿™é‡Œè¿˜åŒ…æ‹¬äº† <code>getTask()</code> æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ä»é˜Ÿåˆ—ä¸­ä¸æ–­çš„è·å–æœªè¢«æ‰§è¡Œçš„çº¿ç¨‹ã€‚</li></ul> <p><strong>å¥½</strong>ï¼Œé‚£ä¹ˆä»¥ä¸Šå‘¢ï¼Œå°±æ˜¯è¿™ä¸ªç®€å•çº¿ç¨‹æ± å®ç°çš„å…·ä½“ä½“ç°ã€‚ä½†å¦‚æœæ·±æ€ç†Ÿè™‘å°±ä¼šå‘ç°è¿™é‡Œéœ€è¦å¾ˆå¤šå®Œå–„ï¼Œæ¯”å¦‚ï¼š<code>çº¿ç¨‹æ± çŠ¶æ€å‘¢ï¼Œä¸å¯èƒ½ä¸€ç›´å¥”è·‘å‘€ï¼ï¼Ÿ</code>ã€<code>çº¿ç¨‹æ± çš„é”å‘¢ï¼Œä¸ä¼šæœ‰å¹¶å‘é—®é¢˜å—ï¼Ÿ</code>ã€<code>çº¿ç¨‹æ± æ‹’ç»åçš„ç­–ç•¥å‘¢ï¼Ÿ</code>ï¼Œè¿™äº›é—®é¢˜éƒ½æ²¡æœ‰åœ¨ä¸»æµç¨‹è§£å†³ï¼Œ<em>ä¹Ÿæ­£å› ä¸ºæ²¡æœ‰è¿™äº›æµç¨‹ï¼Œæ‰€ä»¥ä¸Šé¢çš„ä»£ç æ‰æ›´å®¹æ˜“ç†è§£ã€‚</em></p> <p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¼€å§‹åˆ†æçº¿ç¨‹æ± çš„æºç ï¼Œä¸æˆ‘ä»¬å®ç°çš„ç®€å•çº¿ç¨‹æ± å‚è€ƒå¯¹æ¯”ï¼Œä¼šæ›´åŠ å®¹æ˜“ç†è§£ğŸ˜„ï¼</p> <h3 id="_3-çº¿ç¨‹æ± æºç åˆ†æ"><a href="#_3-çº¿ç¨‹æ± æºç åˆ†æ" class="header-anchor">#</a> 3. çº¿ç¨‹æ± æºç åˆ†æ</h3> <h4 id="_3-1-çº¿ç¨‹æ± ç±»å…³ç³»å›¾"><a href="#_3-1-çº¿ç¨‹æ± ç±»å…³ç³»å›¾" class="header-anchor">#</a> 3.1 çº¿ç¨‹æ± ç±»å…³ç³»å›¾</h4> <p><img alt="å›¾ 21-2 çº¿ç¨‹æ± ç±»å…³ç³»å›¾" data-src="https://bugstack.cn/assets/images/2020/interview/interview-21-2.png" loading="lazy" class="lazy"></p> <p>ä»¥å›´ç»•æ ¸å¿ƒç±» <code>ThreadPoolExecutor</code> çš„å®ç°å±•å¼€çš„ç±»ä¹‹é—´å®ç°å’Œç»§æ‰¿å…³ç³»ï¼Œå¦‚å›¾ 21-2 çº¿ç¨‹æ± ç±»å…³ç³»å›¾ã€‚</p> <ul><li>æ¥å£ <code>Executor</code>ã€<code>ExecutorService</code>ï¼Œå®šä¹‰çº¿ç¨‹æ± çš„åŸºæœ¬æ–¹æ³•ã€‚å°¤å…¶æ˜¯ <code>execute(Runnable command)</code> æäº¤çº¿ç¨‹æ± æ–¹æ³•ã€‚</li> <li>æŠ½è±¡ç±» <code>AbstractExecutorService</code>ï¼Œå®ç°äº†åŸºæœ¬é€šç”¨çš„æ¥å£æ–¹æ³•ã€‚</li> <li><code>ThreadPoolExecutor</code>ï¼Œæ˜¯æ•´ä¸ªçº¿ç¨‹æ± æœ€æ ¸å¿ƒçš„å·¥å…·ç±»æ–¹æ³•ï¼Œæ‰€æœ‰çš„å…¶ä»–ç±»å’Œæ¥å£ï¼Œä¸ºå›´ç»•è¿™ä¸ªç±»æ¥æä¾›å„è‡ªçš„åŠŸèƒ½ã€‚</li> <li><code>Worker</code>ï¼Œæ˜¯ä»»åŠ¡ç±»ï¼Œä¹Ÿå°±æ˜¯æœ€ç»ˆæ‰§è¡Œçš„çº¿ç¨‹çš„æ–¹æ³•ã€‚</li> <li><code>RejectedExecutionHandler</code>ï¼Œæ˜¯æ‹’ç»ç­–ç•¥æ¥å£ï¼Œæœ‰å››ä¸ªå®ç°ç±»ï¼›<code>AbortPolicy(æŠ›å¼‚å¸¸æ–¹å¼æ‹’ç»)</code>ã€<code>DiscardPolicy(ç›´æ¥ä¸¢å¼ƒ)</code>ã€<code>DiscardOldestPolicy(ä¸¢å¼ƒå­˜æ´»æ—¶é—´æœ€é•¿çš„ä»»åŠ¡)</code>ã€<code>CallerRunsPolicy(è°æäº¤è°æ‰§è¡Œ)</code>ã€‚</li> <li><code>Executors</code>ï¼Œæ˜¯ç”¨äºåˆ›å»ºæˆ‘ä»¬å¸¸ç”¨çš„ä¸åŒç­–ç•¥çš„çº¿ç¨‹æ± ï¼Œ<code>newFixedThreadPool</code>ã€<code>newCachedThreadPool</code>ã€<code>newScheduledThreadPool</code>ã€<code>newSingleThreadExecutor</code>ã€‚</li></ul> <h4 id="_3-2-é«˜3ä½ä¸ä½29ä½"><a href="#_3-2-é«˜3ä½ä¸ä½29ä½" class="header-anchor">#</a> 3.2 é«˜3ä½ä¸ä½29ä½</h4> <p><img alt="å›¾ 22-3 çº¿ç¨‹çŠ¶æ€ï¼Œé«˜3ä½ä¸ä½29ä½" data-src="https://bugstack.cn/assets/images/2020/interview/interview-21-3.png" loading="lazy" class="lazy"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AtomicInteger</span> ctl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token function">ctlOf</span><span class="token punctuation">(</span><span class="token constant">RUNNING</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">COUNT_BITS</span> <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">SIZE</span> <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">CAPACITY</span>   <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token constant">COUNT_BITS</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">RUNNING</span>    <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token constant">COUNT_BITS</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">SHUTDOWN</span>   <span class="token operator">=</span>  <span class="token number">0</span> <span class="token operator">&lt;&lt;</span> <span class="token constant">COUNT_BITS</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">STOP</span>       <span class="token operator">=</span>  <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token constant">COUNT_BITS</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">TIDYING</span>    <span class="token operator">=</span>  <span class="token number">2</span> <span class="token operator">&lt;&lt;</span> <span class="token constant">COUNT_BITS</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">TERMINATED</span> <span class="token operator">=</span>  <span class="token number">3</span> <span class="token operator">&lt;&lt;</span> <span class="token constant">COUNT_BITS</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>åœ¨ <code>ThreadPoolExecutor</code> çº¿ç¨‹æ± å®ç°ç±»ä¸­ï¼Œä½¿ç”¨ AtomicInteger ç±»å‹çš„ ctl è®°å½•çº¿ç¨‹æ± çŠ¶æ€å’Œçº¿ç¨‹æ± æ•°é‡ã€‚åœ¨ä¸€ä¸ªç±»å‹ä¸Šè®°å½•å¤šä¸ªå€¼ï¼Œå®ƒé‡‡ç”¨çš„åˆ†å‰²æ•°æ®åŒºåŸŸï¼Œ<code>é«˜3ä½</code>è®°å½•çŠ¶æ€ï¼Œ<code>ä½29ä½</code>å­˜å‚¨çº¿ç¨‹æ•°é‡ï¼Œé»˜è®¤ RUNNING çŠ¶æ€ï¼Œçº¿ç¨‹æ•°ä¸º0ä¸ªã€‚</p> <h4 id="_3-2-çº¿ç¨‹æ± çŠ¶æ€"><a href="#_3-2-çº¿ç¨‹æ± çŠ¶æ€" class="header-anchor">#</a> 3.2 çº¿ç¨‹æ± çŠ¶æ€</h4> <p><img alt="å›¾ 22-4 çº¿ç¨‹æ± çŠ¶æ€æµè½¬" data-src="https://bugstack.cn/assets/images/2020/interview/interview-21-4.png" loading="lazy" class="lazy"></p> <p>å›¾ 22-4 æ˜¯çº¿ç¨‹æ± ä¸­çš„çŠ¶æ€æµè½¬å…³ç³»ï¼ŒåŒ…æ‹¬å¦‚ä¸‹çŠ¶æ€ï¼š</p> <ul><li><code>RUNNING</code>ï¼šè¿è¡ŒçŠ¶æ€ï¼Œæ¥å—æ–°çš„ä»»åŠ¡å¹¶ä¸”å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚</li> <li><code>SHUTDOWN</code>ï¼šå…³é—­çŠ¶æ€(è°ƒç”¨äº†shutdownæ–¹æ³•)ã€‚ä¸æ¥å—æ–°ä»»åŠ¡ï¼Œ,ä½†æ˜¯è¦å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚</li> <li><code>STOP</code>ï¼šåœæ­¢çŠ¶æ€(è°ƒç”¨äº†shutdownNowæ–¹æ³•)ã€‚ä¸æ¥å—æ–°ä»»åŠ¡ï¼Œä¹Ÿä¸å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œå¹¶ä¸”è¦ä¸­æ–­æ­£åœ¨å¤„ç†çš„ä»»åŠ¡ã€‚</li> <li><code>TIDYING</code>ï¼šæ‰€æœ‰çš„ä»»åŠ¡éƒ½å·²ç»ˆæ­¢äº†ï¼ŒworkerCountä¸º0ï¼Œçº¿ç¨‹æ± è¿›å…¥è¯¥çŠ¶æ€åä¼šè°ƒ terminated() æ–¹æ³•è¿›å…¥TERMINATED çŠ¶æ€ã€‚</li> <li><code>TERMINATED</code>ï¼šç»ˆæ­¢çŠ¶æ€ï¼Œterminated() æ–¹æ³•è°ƒç”¨ç»“æŸåçš„çŠ¶æ€ã€‚</li></ul> <h4 id="_3-3-æäº¤çº¿ç¨‹-execute"><a href="#_3-3-æäº¤çº¿ç¨‹-execute" class="header-anchor">#</a> 3.3 æäº¤çº¿ç¨‹(execute)</h4> <p><img alt="å›¾ 22-5 æäº¤çº¿ç¨‹æµç¨‹å›¾" data-src="https://bugstack.cn/assets/images/2020/interview/interview-21-5.png" loading="lazy" class="lazy"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> command<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>command <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> c <span class="token operator">=</span> ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">workerCountOf</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">&lt;</span> corePoolSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">addWorker</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        c <span class="token operator">=</span> ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isRunning</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> workQueue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> recheck <span class="token operator">=</span> ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">isRunning</span><span class="token punctuation">(</span>recheck<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">remove</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">workerCountOf</span><span class="token punctuation">(</span>recheck<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token function">addWorker</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">addWorker</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>åœ¨é˜…è¯»è¿™éƒ¨åˆ†æºç çš„æ—¶å€™ï¼Œå¯ä»¥å‚è€ƒæˆ‘ä»¬è‡ªå·±å®ç°çš„çº¿ç¨‹æ± ã€‚å…¶å®æœ€ç»ˆçš„ç›®çš„éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯è¿™æ®µè¢«æäº¤çš„çº¿ç¨‹ï¼Œ<code>å¯åŠ¨æ‰§è¡Œ</code>ã€<code>åŠ å…¥é˜Ÿåˆ—</code>ã€<code>å†³ç­–ç­–ç•¥</code>ï¼Œè¿™ä¸‰ç§æ–¹å¼ã€‚</p> <ul><li><code>ctl.get()</code>ï¼Œå–çš„æ˜¯è®°å½•çº¿ç¨‹çŠ¶æ€å’Œçº¿ç¨‹ä¸ªæ•°çš„å€¼ï¼Œæœ€ç»ˆéœ€è¦ä½¿ç”¨æ–¹æ³• <code>workerCountOf()</code>ï¼Œæ¥è·å–å½“å‰çº¿ç¨‹æ•°é‡ã€‚<em>`workerCountOf æ‰§è¡Œçš„æ˜¯ c &amp; CAPACITY è¿ç®—</em></li> <li>æ ¹æ®å½“å‰çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°é‡ï¼Œä¸æ ¸å¿ƒçº¿ç¨‹æ•° <code>corePoolSize</code> åšå¯¹æ¯”ï¼Œå°äºåˆ™è¿›è¡Œæ·»åŠ çº¿ç¨‹åˆ°ä»»åŠ¡æ‰§è¡Œé˜Ÿåˆ—ã€‚</li> <li>å¦‚æœè¯´æ­¤æ—¶çº¿ç¨‹æ•°å·²æ»¡ï¼Œé‚£ä¹ˆåˆ™éœ€è¦åˆ¤æ–­çº¿ç¨‹æ± æ˜¯å¦ä¸ºè¿è¡ŒçŠ¶æ€ <code>isRunning(c)</code>ã€‚å¦‚æœæ˜¯è¿è¡ŒçŠ¶æ€åˆ™æŠŠä¸èƒ½è¢«æ‰§è¡Œçš„çº¿ç¨‹æ”¾å…¥çº¿ç¨‹é˜Ÿåˆ—ä¸­ã€‚</li> <li>æ”¾å…¥çº¿ç¨‹é˜Ÿåˆ—ä»¥åï¼Œè¿˜éœ€è¦é‡æ–°åˆ¤æ–­çº¿ç¨‹æ˜¯å¦è¿è¡Œä»¥åŠç§»é™¤æ“ä½œï¼Œå¦‚æœéè¿è¡Œä¸”ç§»é™¤ï¼Œåˆ™è¿›è¡Œæ‹’ç»ç­–ç•¥ã€‚å¦åˆ™åˆ¤æ–­çº¿ç¨‹æ•°é‡ä¸º0åæ·»åŠ æ–°çº¿ç¨‹ã€‚</li> <li>æœ€åå°±æ˜¯å†æ¬¡å°è¯•æ·»åŠ ä»»åŠ¡æ‰§è¡Œï¼Œæ­¤æ—¶æ–¹æ³• addWorker çš„ç¬¬äºŒä¸ªå…¥å‚æ˜¯ falseï¼Œæœ€ç»ˆä¼šå½±å“æ·»åŠ æ‰§è¡Œä»»åŠ¡æ•°é‡åˆ¤æ–­ã€‚å¦‚æœæ·»åŠ å¤±è´¥åˆ™è¿›è¡Œæ‹’ç»ç­–ç•¥ã€‚</li></ul> <h4 id="_3-5-æ·»åŠ æ‰§è¡Œä»»åŠ¡-addworker"><a href="#_3-5-æ·»åŠ æ‰§è¡Œä»»åŠ¡-addworker" class="header-anchor">#</a> 3.5 æ·»åŠ æ‰§è¡Œä»»åŠ¡(addWorker)</h4> <p><img alt="å›¾ 22-6 æ·»åŠ æ‰§è¡Œä»»åŠ¡é€»è¾‘æµç¨‹" data-src="https://bugstack.cn/assets/images/2020/interview/interview-21-6.png" loading="lazy" class="lazy"></p> <p><strong>private boolean addWorker(Runnable firstTask, boolean core)</strong></p> <p><strong>ç¬¬ä¸€éƒ¨åˆ†ã€å¢åŠ çº¿ç¨‹æ•°é‡</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>retry<span class="token operator">:</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> c <span class="token operator">=</span> ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> rs <span class="token operator">=</span> <span class="token function">runStateOf</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Check if queue empty only if necessary.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rs <span class="token operator">&gt;=</span> <span class="token constant">SHUTDOWN</span> <span class="token operator">&amp;&amp;</span>
        <span class="token operator">!</span> <span class="token punctuation">(</span>rs <span class="token operator">==</span> <span class="token constant">SHUTDOWN</span> <span class="token operator">&amp;&amp;</span>
           firstTask <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
           <span class="token operator">!</span> workQueue<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> wc <span class="token operator">=</span> <span class="token function">workerCountOf</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>wc <span class="token operator">&gt;=</span> <span class="token constant">CAPACITY</span> <span class="token operator">||</span>
            wc <span class="token operator">&gt;=</span> <span class="token punctuation">(</span>core <span class="token operator">?</span> corePoolSize <span class="token operator">:</span> maximumPoolSize<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">compareAndIncrementWorkerCount</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span> retry<span class="token punctuation">;</span>
        c <span class="token operator">=</span> ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Re-read ctl</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">runStateOf</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">!=</span> rs<span class="token punctuation">)</span>
            <span class="token keyword">continue</span> retry<span class="token punctuation">;</span>
        <span class="token comment">// else CAS failed due to workerCount change; retry inner loop</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><strong>ç¬¬ä¸€éƒ¨åˆ†ã€åˆ›å»ºå¯åŠ¨çº¿ç¨‹</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">boolean</span> workerStarted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">boolean</span> workerAdded <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token class-name">Worker</span> w <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
    w <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span>firstTask<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">Thread</span> t <span class="token operator">=</span> w<span class="token punctuation">.</span>thread<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> mainLock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mainLock<span class="token punctuation">;</span>
        mainLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> rs <span class="token operator">=</span> <span class="token function">runStateOf</span><span class="token punctuation">(</span>ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>rs <span class="token operator">&lt;</span> <span class="token constant">SHUTDOWN</span> <span class="token operator">||</span>
                <span class="token punctuation">(</span>rs <span class="token operator">==</span> <span class="token constant">SHUTDOWN</span> <span class="token operator">&amp;&amp;</span> firstTask <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// precheck that t is startable</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalThreadStateException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                workers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> s <span class="token operator">=</span> workers<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">&gt;</span> largestPoolSize<span class="token punctuation">)</span>
                    largestPoolSize <span class="token operator">=</span> s<span class="token punctuation">;</span>
                workerAdded <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            mainLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>workerAdded<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            workerStarted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> workerStarted<span class="token punctuation">)</span>
        <span class="token function">addWorkerFailed</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">return</span> workerStarted<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>æ·»åŠ æ‰§è¡Œä»»åŠ¡çš„æµç¨‹å¯ä»¥åˆ†ä¸ºä¸¤å—çœ‹ï¼Œä¸Šé¢ä»£ç éƒ¨åˆ†æ˜¯ç”¨äºè®°å½•çº¿ç¨‹æ•°é‡ã€ä¸‹é¢ä»£ç éƒ¨åˆ†æ˜¯åœ¨ç‹¬å é”é‡Œåˆ›å»ºæ‰§è¡Œçº¿ç¨‹å¹¶å¯åŠ¨ã€‚<em>è¿™éƒ¨åˆ†ä»£ç åœ¨ä¸çœ‹é”ã€CASç­‰æ“ä½œï¼Œé‚£ä¹ˆå°±å’Œæˆ‘ä»¬æœ€å¼€å§‹æ‰‹å†™çš„çº¿ç¨‹æ± åŸºæœ¬ä¸€æ ·äº†</em></p> <ul><li><code>if (rs &gt;= SHUTDOWN &amp;&amp;! (rs == SHUTDOWN &amp;&amp;firstTask == null &amp;&amp;! workQueue.isEmpty()))</code>ï¼Œåˆ¤æ–­å½“å‰çº¿ç¨‹æ± çŠ¶æ€ï¼Œæ˜¯å¦ä¸º <code>SHUTDOWN</code>ã€<code>STOP</code>ã€<code>TIDYING</code>ã€<code>TERMINATED</code>ä¸­çš„ä¸€ä¸ªã€‚å¹¶ä¸”å½“å‰çŠ¶æ€ä¸º <code>SHUTDOWN</code>ã€ä¸”ä¼ å…¥çš„ä»»åŠ¡ä¸º nullï¼ŒåŒæ—¶é˜Ÿåˆ—ä¸ä¸ºç©ºã€‚é‚£ä¹ˆå°±è¿”å› falseã€‚</li> <li><code>compareAndIncrementWorkerCount</code>ï¼ŒCAS æ“ä½œï¼Œå¢åŠ çº¿ç¨‹æ•°é‡ï¼ŒæˆåŠŸå°±ä¼šè·³å‡ºæ ‡è®°çš„å¾ªç¯ä½“ã€‚</li> <li><code>runStateOf(c) != rs</code>ï¼Œæœ€åæ˜¯çº¿ç¨‹æ± çŠ¶æ€åˆ¤æ–­ï¼Œå†³å®šæ˜¯å¦å¾ªç¯ã€‚</li> <li>åœ¨çº¿ç¨‹æ± æ•°é‡è®°å½•æˆåŠŸåï¼Œåˆ™éœ€è¦è¿›å…¥åŠ é”ç¯èŠ‚ï¼Œåˆ›å»ºæ‰§è¡Œçº¿ç¨‹ï¼Œå¹¶è®°å½•çŠ¶æ€ã€‚åœ¨æœ€åå¦‚æœåˆ¤æ–­æ²¡æœ‰å¯åŠ¨æˆåŠŸï¼Œåˆ™éœ€è¦æ‰§è¡Œ addWorkerFailed æ–¹æ³•ï¼Œå‰”é™¤åˆ°çº¿ç¨‹æ–¹æ³•ç­‰æ“ä½œã€‚</li></ul> <h4 id="_3-6-æ‰§è¡Œçº¿ç¨‹-runworker"><a href="#_3-6-æ‰§è¡Œçº¿ç¨‹-runworker" class="header-anchor">#</a> 3.6 æ‰§è¡Œçº¿ç¨‹(runWorker)</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">runWorker</span><span class="token punctuation">(</span><span class="token class-name">Worker</span> w<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> wt <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Runnable</span> task <span class="token operator">=</span> w<span class="token punctuation">.</span>firstTask<span class="token punctuation">;</span>
    w<span class="token punctuation">.</span>firstTask <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    w<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å…è®¸ä¸­æ–­</span>
    <span class="token keyword">boolean</span> completedAbruptly <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>task <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token punctuation">(</span>task <span class="token operator">=</span> <span class="token function">getTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> 
            w<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">runStateAtLeast</span><span class="token punctuation">(</span>ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">STOP</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                 <span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">interrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                  <span class="token function">runStateAtLeast</span><span class="token punctuation">(</span>ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">STOP</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                <span class="token operator">!</span>wt<span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                wt<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token function">beforeExecute</span><span class="token punctuation">(</span>wt<span class="token punctuation">,</span> task<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Throwable</span> thrown <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    task<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                    <span class="token function">afterExecute</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> thrown<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                task <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                w<span class="token punctuation">.</span>completedTasks<span class="token operator">++</span><span class="token punctuation">;</span>
                w<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        completedAbruptly <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token function">processWorkerExit</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> completedAbruptly<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p><strong>å…¶å®</strong>ï¼Œæœ‰äº†æ‰‹å†™çº¿ç¨‹æ± çš„åŸºç¡€ï¼Œåˆ°è¿™ä¹Ÿå°±åŸºæœ¬äº†è§£äº†ï¼Œçº¿ç¨‹æ± åœ¨å¹²å˜›ã€‚åˆ°è¿™æœ€æ ¸å¿ƒçš„ç‚¹å°±æ˜¯ <code>task.run()</code> è®©çº¿ç¨‹è·‘èµ·æ¥ã€‚é¢å¤–å†é™„å¸¦ä¸€äº›å…¶ä»–æµç¨‹å¦‚ä¸‹ï¼›</p> <ul><li><code>beforeExecute</code>ã€<code>afterExecute</code>ï¼Œçº¿ç¨‹æ‰§è¡Œçš„å‰ååšä¸€äº›ç»Ÿè®¡ä¿¡æ¯ã€‚</li> <li>å¦å¤–è¿™é‡Œçš„é”æ“ä½œæ˜¯ Worker ç»§æ‰¿ AQS è‡ªå·±å®ç°çš„ä¸å¯é‡å…¥çš„ç‹¬å é”ã€‚</li> <li><code>processWorkerExit</code>ï¼Œå¦‚æœä½ æ„Ÿå…´è¶£ï¼Œç±»ä¼¼è¿™æ ·çš„æ–¹æ³•ä¹Ÿå¯ä»¥æ·±å…¥äº†è§£ä¸‹ã€‚<em>åœ¨çº¿ç¨‹é€€å‡ºæ—¶å€™workersåšåˆ°ä¸€äº›ç§»é™¤å¤„ç†ä»¥åŠå®Œæˆä»»åŠ¡æ•°ç­‰ï¼Œä¹Ÿéå¸¸æœ‰æ„æ€</em></li></ul> <h4 id="_3-7-é˜Ÿåˆ—è·å–ä»»åŠ¡-gettask"><a href="#_3-7-é˜Ÿåˆ—è·å–ä»»åŠ¡-gettask" class="header-anchor">#</a> 3.7 é˜Ÿåˆ—è·å–ä»»åŠ¡(getTask)</h4> <p>å¦‚æœä½ å·²ç»å¼€å§‹é˜…è¯»æºç ï¼Œå¯ä»¥åœ¨ runWorker æ–¹æ³•ä¸­ï¼Œçœ‹åˆ°è¿™æ ·ä¸€å¥å¾ªç¯ä»£ç  <code>while (task != null || (task = getTask()) != null)</code>ã€‚è¿™ä¸æˆ‘ä»¬æ‰‹å†™çº¿ç¨‹æ± ä¸­æ“ä½œçš„æ–¹å¼æ˜¯ä¸€æ ·çš„ï¼Œæ ¸å¿ƒç›®çš„å°±æ˜¯ä»é˜Ÿåˆ—ä¸­è·å–çº¿ç¨‹æ–¹æ³•ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">Runnable</span> <span class="token function">getTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> timedOut <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// Did the last poll() time out?</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> c <span class="token operator">=</span> ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> rs <span class="token operator">=</span> <span class="token function">runStateOf</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Check if queue empty only if necessary.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>rs <span class="token operator">&gt;=</span> <span class="token constant">SHUTDOWN</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>rs <span class="token operator">&gt;=</span> <span class="token constant">STOP</span> <span class="token operator">||</span> workQueue<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">decrementWorkerCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">int</span> wc <span class="token operator">=</span> <span class="token function">workerCountOf</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Are workers subject to culling?</span>
        <span class="token keyword">boolean</span> timed <span class="token operator">=</span> allowCoreThreadTimeOut <span class="token operator">||</span> wc <span class="token operator">&gt;</span> corePoolSize<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>wc <span class="token operator">&gt;</span> maximumPoolSize <span class="token operator">||</span> <span class="token punctuation">(</span>timed <span class="token operator">&amp;&amp;</span> timedOut<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>wc <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">||</span> workQueue<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">compareAndDecrementWorkerCount</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Runnable</span> r <span class="token operator">=</span> timed <span class="token operator">?</span>
                workQueue<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span>keepAliveTime<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">NANOSECONDS</span><span class="token punctuation">)</span> <span class="token operator">:</span>
                workQueue<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> r<span class="token punctuation">;</span>
            timedOut <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> retry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            timedOut <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><ul><li>getTask æ–¹æ³•ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ç­‰å¾…è¢«æ‰§è¡Œçš„ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯ä¸€æ¡æ¡å¾€å‡ºæ‹¿çº¿ç¨‹æ–¹æ³•ã€‚</li> <li><code>if (rs &gt;= SHUTDOWN ...</code>ï¼Œåˆ¤æ–­çº¿ç¨‹æ˜¯å¦å…³é—­ã€‚</li> <li><code>wc = workerCountOf(c)ï¼Œwc &gt; corePoolSize</code>ï¼Œå¦‚æœå·¥ä½œçº¿ç¨‹æ•°è¶…è¿‡æ ¸å¿ƒçº¿ç¨‹æ•°é‡ <code>corePoolSize</code> å¹¶ä¸” workQueue ä¸ä¸ºç©ºï¼Œåˆ™å¢åŠ å·¥ä½œçº¿ç¨‹ã€‚ä½†å¦‚æœè¶…æ—¶æœªè·å–åˆ°çº¿ç¨‹ï¼Œåˆ™ä¼šæŠŠå¤§äº corePoolSize çš„çº¿ç¨‹é”€æ¯æ‰ã€‚</li> <li><code>timed</code>ï¼Œæ˜¯ <code>allowCoreThreadTimeOut</code> å¾—æ¥çš„ã€‚æœ€ç»ˆ <code>timed</code> ä¸º true æ—¶ï¼Œåˆ™é€šè¿‡é˜»å¡é˜Ÿåˆ—çš„pollæ–¹æ³•è¿›è¡Œè¶…æ—¶æ§åˆ¶ã€‚</li> <li>å¦‚æœåœ¨ <code>keepAliveTime</code> æ—¶é—´å†…æ²¡æœ‰è·å–åˆ°ä»»åŠ¡ï¼Œåˆ™è¿”å›nullã€‚å¦‚æœä¸ºfalseï¼Œåˆ™é˜»å¡ã€‚</li></ul> <h2 id="å››ã€æ€»ç»“"><a href="#å››ã€æ€»ç»“" class="header-anchor">#</a> å››ã€æ€»ç»“</h2> <ul><li>è¿™ä¸€ç« èŠ‚å¹¶æ²¡æœ‰å®Œå…¨æŠŠçº¿ç¨‹æ± çš„æ‰€æœ‰çŸ¥è¯†ç‚¹éƒ½ä»‹ç»å®Œï¼Œå¦åˆ™ä¸€ç¯‡å†…å®¹ä¼šæœ‰äº›è‡ƒè‚¿ã€‚åœ¨è¿™ä¸€ç« èŠ‚æˆ‘ä»¬ä»æ‰‹å†™çº¿ç¨‹æ± å¼€å§‹ï¼Œé€æ­¥çš„åˆ†æè¿™äº›ä»£ç åœ¨Javaçš„çº¿ç¨‹æ± ä¸­æ˜¯å¦‚ä½•å®ç°çš„ï¼Œæ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹ä¹Ÿå‡ ä¹æ˜¯æˆ‘ä»¬ä»¥å‰ä»‹ç»è¿‡çš„å†…å®¹ï¼ŒåŒ…æ‹¬ï¼šé˜Ÿåˆ—ã€CASã€AQSã€é‡å…¥é”ã€ç‹¬å é”ç­‰å†…å®¹ã€‚æ‰€ä»¥è¿™äº›çŸ¥è¯†ä¹ŸåŸºæœ¬æ˜¯ç¯ç¯ç›¸æ‰£çš„ï¼Œæœ€å¥½æœ‰ä¸€äº›æ ¹åŸºå¦åˆ™ä¼šæœ‰äº›ä¸å¥½ç†è§£ã€‚</li> <li>é™¤äº†æœ¬ç« ä»‹ç»çš„ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰è®²åˆ°çº¿ç¨‹çš„é”€æ¯è¿‡ç¨‹ã€å››ç§çº¿ç¨‹æ± æ–¹æ³•çš„é€‰æ‹©å’Œä½¿ç”¨ã€ä»¥åŠåœ¨<code>CPUå¯†é›†å‹ä»»åŠ¡</code>ã€<code>IO å¯†é›†å‹ä»»åŠ¡</code>æ—¶è¯¥æ€ä¹ˆé…ç½®ã€‚å¦å¤–åœ¨Springä¸­ä¹Ÿæœ‰è‡ªå·±å®ç°çš„çº¿ç¨‹æ± æ–¹æ³•ã€‚è¿™äº›çŸ¥è¯†ç‚¹éƒ½éå¸¸è´´è¿‘å®é™…æ“ä½œã€‚</li> <li>å¥½äº†ï¼Œä»Šå¤©çš„å†…å®¹å…ˆæ‰¯åˆ°è¿™ï¼Œåç»­çš„å†…å®¹é™†ç»­å®Œå–„ã€‚å¦‚æœä»¥ä¸Šå†…å®¹æœ‰é”™å­—ã€æµç¨‹ç¼ºå¤±ã€æˆ–è€…ä¸å¥½ç†è§£ä»¥åŠæè¿°é”™è¯¯ï¼Œæ¬¢è¿ç•™è¨€ã€‚äº’ç›¸å­¦ä¹ ã€äº’ç›¸è¿›æ­¥ã€‚</li></ul></div> <footer class="page-edit"><div class="edit-link"><a rel="noopener noreferrer"> aaaa </a></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/md/java/interview/2020-12-02-é¢ç»æ‰‹å†Œ Â· ç¬¬20ç¯‡ã€ŠThread çº¿ç¨‹ï¼ŒçŠ¶æ€è½¬æ¢ã€æ–¹æ³•ä½¿ç”¨ã€åŸç†åˆ†æã€‹.html" class="prev">
          é¢ç»æ‰‹å†Œ Â· ç¬¬20ç¯‡ã€ŠThread çº¿ç¨‹ï¼ŒçŠ¶æ€è½¬æ¢ã€æ–¹æ³•ä½¿ç”¨ã€åŸç†åˆ†æã€‹
        </a></span> <span class="next"><a href="/md/java/interview/2020-12-16-é¢ç»æ‰‹å†Œ Â· ç¬¬22ç¯‡ã€Šçº¿ç¨‹æ± çš„ä»‹ç»å’Œä½¿ç”¨ï¼Œä»¥åŠåŸºäºjvmtiè®¾è®¡éå…¥ä¾µç›‘æ§ã€‹.html">
          é¢ç»æ‰‹å†Œ Â· ç¬¬22ç¯‡ã€Šçº¿ç¨‹æ± çš„ä»‹ç»å’Œä½¿ç”¨ï¼Œä»¥åŠåŸºäºjvmtiè®¾è®¡éå…¥ä¾µç›‘æ§ã€‹
        </a>
        â†’
      </span></p></div> </main></div> <aside class="page-sidebar"> <div class="page-side-toolbar"><div class="option-box-toc-fixed"><div class="toc-container-sidebar"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="max-height:650px"><div style="font-weight:bold;text-align:center;">é¢ç»æ‰‹å†Œ Â· ç¬¬21ç¯‡ã€Šæ‰‹å†™çº¿ç¨‹æ± ï¼Œå¯¹ç…§å­¦ä¹ ThreadPoolExecutorçº¿ç¨‹æ± å®ç°åŸç†ï¼ã€‹</div> <hr> <div class="toc-box"><ul class="toc-sidebar-links"><li><a href="/md/java/interview/2020-12-09-%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C%20%C2%B7%20%E7%AC%AC21%E7%AF%87%E3%80%8A%E6%89%8B%E5%86%99%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%8C%E5%AF%B9%E7%85%A7%E5%AD%A6%E4%B9%A0ThreadPoolExecutor%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%EF%BC%81%E3%80%8B.html#ä¸€ã€å‰è¨€" class="toc-sidebar-link">ä¸€ã€å‰è¨€</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/md/java/interview/2020-12-09-%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C%20%C2%B7%20%E7%AC%AC21%E7%AF%87%E3%80%8A%E6%89%8B%E5%86%99%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%8C%E5%AF%B9%E7%85%A7%E5%AD%A6%E4%B9%A0ThreadPoolExecutor%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%EF%BC%81%E3%80%8B.html#äºŒã€é¢è¯•é¢˜" class="toc-sidebar-link">äºŒã€é¢è¯•é¢˜</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/md/java/interview/2020-12-09-%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C%20%C2%B7%20%E7%AC%AC21%E7%AF%87%E3%80%8A%E6%89%8B%E5%86%99%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%8C%E5%AF%B9%E7%85%A7%E5%AD%A6%E4%B9%A0ThreadPoolExecutor%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%EF%BC%81%E3%80%8B.html#ä¸‰ã€çº¿ç¨‹æ± è®²è§£" class="toc-sidebar-link">ä¸‰ã€çº¿ç¨‹æ± è®²è§£</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/md/java/interview/2020-12-09-%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C%20%C2%B7%20%E7%AC%AC21%E7%AF%87%E3%80%8A%E6%89%8B%E5%86%99%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%8C%E5%AF%B9%E7%85%A7%E5%AD%A6%E4%B9%A0ThreadPoolExecutor%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%EF%BC%81%E3%80%8B.html#_1-å…ˆçœ‹ä¸ªä¾‹å­" class="toc-sidebar-link">1. å…ˆçœ‹ä¸ªä¾‹å­</a></li><li class="toc-sidebar-sub-header"><a href="/md/java/interview/2020-12-09-%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C%20%C2%B7%20%E7%AC%AC21%E7%AF%87%E3%80%8A%E6%89%8B%E5%86%99%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%8C%E5%AF%B9%E7%85%A7%E5%AD%A6%E4%B9%A0ThreadPoolExecutor%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%EF%BC%81%E3%80%8B.html#_2-æ‰‹å†™ä¸€ä¸ªçº¿ç¨‹æ± " class="toc-sidebar-link">2. æ‰‹å†™ä¸€ä¸ªçº¿ç¨‹æ± </a></li><li class="toc-sidebar-sub-header"><a href="/md/java/interview/2020-12-09-%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C%20%C2%B7%20%E7%AC%AC21%E7%AF%87%E3%80%8A%E6%89%8B%E5%86%99%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%8C%E5%AF%B9%E7%85%A7%E5%AD%A6%E4%B9%A0ThreadPoolExecutor%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%EF%BC%81%E3%80%8B.html#_3-çº¿ç¨‹æ± æºç åˆ†æ" class="toc-sidebar-link">3. çº¿ç¨‹æ± æºç åˆ†æ</a></li></ul></li><li><a href="/md/java/interview/2020-12-09-%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C%20%C2%B7%20%E7%AC%AC21%E7%AF%87%E3%80%8A%E6%89%8B%E5%86%99%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%8C%E5%AF%B9%E7%85%A7%E5%AD%A6%E4%B9%A0ThreadPoolExecutor%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%EF%BC%81%E3%80%8B.html#å››ã€æ€»ç»“" class="toc-sidebar-link">å››ã€æ€»ç»“</a><ul class="toc-sidebar-sub-headers"></ul></li></ul></div></div></div></div></div> <div class="option-box-toc-over"><img src="/images/system/toc.png" class="nozoom"> <span class="show-txt">ç›®å½•</span> <div class="toc-container"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="max-height:550px"><div style="font-weight:bold;text-align:center;">é¢ç»æ‰‹å†Œ Â· ç¬¬21ç¯‡ã€Šæ‰‹å†™çº¿ç¨‹æ± ï¼Œå¯¹ç…§å­¦ä¹ ThreadPoolExecutorçº¿ç¨‹æ± å®ç°åŸç†ï¼ã€‹</div> <hr> <div class="toc-box"><ul class="toc-sidebar-links"><li><a href="/md/java/interview/2020-12-09-%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C%20%C2%B7%20%E7%AC%AC21%E7%AF%87%E3%80%8A%E6%89%8B%E5%86%99%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%8C%E5%AF%B9%E7%85%A7%E5%AD%A6%E4%B9%A0ThreadPoolExecutor%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%EF%BC%81%E3%80%8B.html#ä¸€ã€å‰è¨€" class="toc-sidebar-link">ä¸€ã€å‰è¨€</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/md/java/interview/2020-12-09-%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C%20%C2%B7%20%E7%AC%AC21%E7%AF%87%E3%80%8A%E6%89%8B%E5%86%99%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%8C%E5%AF%B9%E7%85%A7%E5%AD%A6%E4%B9%A0ThreadPoolExecutor%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%EF%BC%81%E3%80%8B.html#äºŒã€é¢è¯•é¢˜" class="toc-sidebar-link">äºŒã€é¢è¯•é¢˜</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/md/java/interview/2020-12-09-%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C%20%C2%B7%20%E7%AC%AC21%E7%AF%87%E3%80%8A%E6%89%8B%E5%86%99%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%8C%E5%AF%B9%E7%85%A7%E5%AD%A6%E4%B9%A0ThreadPoolExecutor%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%EF%BC%81%E3%80%8B.html#ä¸‰ã€çº¿ç¨‹æ± è®²è§£" class="toc-sidebar-link">ä¸‰ã€çº¿ç¨‹æ± è®²è§£</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/md/java/interview/2020-12-09-%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C%20%C2%B7%20%E7%AC%AC21%E7%AF%87%E3%80%8A%E6%89%8B%E5%86%99%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%8C%E5%AF%B9%E7%85%A7%E5%AD%A6%E4%B9%A0ThreadPoolExecutor%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%EF%BC%81%E3%80%8B.html#_1-å…ˆçœ‹ä¸ªä¾‹å­" class="toc-sidebar-link">1. å…ˆçœ‹ä¸ªä¾‹å­</a></li><li class="toc-sidebar-sub-header"><a href="/md/java/interview/2020-12-09-%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C%20%C2%B7%20%E7%AC%AC21%E7%AF%87%E3%80%8A%E6%89%8B%E5%86%99%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%8C%E5%AF%B9%E7%85%A7%E5%AD%A6%E4%B9%A0ThreadPoolExecutor%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%EF%BC%81%E3%80%8B.html#_2-æ‰‹å†™ä¸€ä¸ªçº¿ç¨‹æ± " class="toc-sidebar-link">2. æ‰‹å†™ä¸€ä¸ªçº¿ç¨‹æ± </a></li><li class="toc-sidebar-sub-header"><a href="/md/java/interview/2020-12-09-%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C%20%C2%B7%20%E7%AC%AC21%E7%AF%87%E3%80%8A%E6%89%8B%E5%86%99%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%8C%E5%AF%B9%E7%85%A7%E5%AD%A6%E4%B9%A0ThreadPoolExecutor%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%EF%BC%81%E3%80%8B.html#_3-çº¿ç¨‹æ± æºç åˆ†æ" class="toc-sidebar-link">3. çº¿ç¨‹æ± æºç åˆ†æ</a></li></ul></li><li><a href="/md/java/interview/2020-12-09-%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C%20%C2%B7%20%E7%AC%AC21%E7%AF%87%E3%80%8A%E6%89%8B%E5%86%99%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%8C%E5%AF%B9%E7%85%A7%E5%AD%A6%E4%B9%A0ThreadPoolExecutor%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%EF%BC%81%E3%80%8B.html#å››ã€æ€»ç»“" class="toc-sidebar-link">å››ã€æ€»ç»“</a><ul class="toc-sidebar-sub-headers"></ul></li></ul></div></div></div></div></div> <div class="option-box"><img src="/images/system/github.png" width="28px" class="nozoom"> <span class="show-txt">Github</span></div> <div class="option-box"><img src="/images/system/gitee.png" width="28px" class="nozoom"> <span class="show-txt">Gitee</span></div> <div class="option-box"><img src="/images/system/left.png" width="28px" class="nozoom"> <span class="show-txt">å·¦æ </span></div> <div title="é¢ç»æ‰‹å†Œ Â· ç¬¬20ç¯‡ã€ŠThread çº¿ç¨‹ï¼ŒçŠ¶æ€è½¬æ¢ã€æ–¹æ³•ä½¿ç”¨ã€åŸç†åˆ†æã€‹" class="option-box" style="padding-left:2px;text-align:center;"><a href="/md/java/interview/2020-12-02-é¢ç»æ‰‹å†Œ Â· ç¬¬20ç¯‡ã€ŠThread çº¿ç¨‹ï¼ŒçŠ¶æ€è½¬æ¢ã€æ–¹æ³•ä½¿ç”¨ã€åŸç†åˆ†æã€‹.html"><img src="/images/system/prev.png" width="28px" class="nozoom"> <span class="show-txt">ä¸Šä¸€ç¯‡</span></a></div> <div title="é¢ç»æ‰‹å†Œ Â· ç¬¬22ç¯‡ã€Šçº¿ç¨‹æ± çš„ä»‹ç»å’Œä½¿ç”¨ï¼Œä»¥åŠåŸºäºjvmtiè®¾è®¡éå…¥ä¾µç›‘æ§ã€‹" class="option-box" style="padding-left:2px;text-align:center;"><a href="/md/java/interview/2020-12-16-é¢ç»æ‰‹å†Œ Â· ç¬¬22ç¯‡ã€Šçº¿ç¨‹æ± çš„ä»‹ç»å’Œä½¿ç”¨ï¼Œä»¥åŠåŸºäºjvmtiè®¾è®¡éå…¥ä¾µç›‘æ§ã€‹.html"><img src="/images/system/next.png" width="28px" class="nozoom"> <span class="show-txt">ä¸‹ä¸€ç¯‡</span></a></div></div>  <!----> </aside></div><div class="global-ui"><LockArticle></LockArticle><PayArticle></PayArticle></div></div>
    <script src="/assets/js/cg-styles.js?v=1686842317929" defer></script><script src="/assets/js/cg-3.js?v=1686842317929" defer></script><script src="/assets/js/cg-4.js?v=1686842317929" defer></script><script src="/assets/js/cg-51.js?v=1686842317929" defer></script><script src="/assets/js/cg-app.js?v=1686842317929" defer></script>
  </body>
</html>
